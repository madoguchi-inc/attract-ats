<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Attract ATS - æ¡ç”¨ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</title>
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script crossorigin src="https://unpkg.com/prop-types@15/prop-types.min.js"></script>
<script crossorigin src="https://unpkg.com/recharts@2.5.0/umd/Recharts.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Kaku Gothic ProN', sans-serif; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useMemo, useEffect, useCallback } = React;
const { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, LineChart, Line, RadarChart, Radar, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Legend } = Recharts;

// ============================================================
// SUPABASE è¨­å®š (CDNä¸è¦ãƒ»fetch APIç›´æ¥å‘¼ã³å‡ºã—)
// ============================================================
const SUPABASE_URL = 'https://enzgjnelimfrosilsokn.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVuemdqbmVsaW1mcm9zaWxzb2tuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxNjU0MzQsImV4cCI6MjA4Nzc0MTQzNH0.lGp7juqG5IPjSiXa7E8dWtyl7q1CH34ntodzCetFN3U';
const SUPABASE_READY = SUPABASE_URL !== 'YOUR_SUPABASE_URL';

// ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
const tokenStore = {
  get accessToken() { return localStorage.getItem('sb_access_token'); },
  get refreshToken() { return localStorage.getItem('sb_refresh_token'); },
  save(session) {
    localStorage.setItem('sb_access_token', session.access_token);
    localStorage.setItem('sb_refresh_token', session.refresh_token);
  },
  clear() {
    localStorage.removeItem('sb_access_token');
    localStorage.removeItem('sb_refresh_token');
  }
};

// Supabase REST API ãƒ˜ãƒ«ãƒ‘ãƒ¼
const sbApi = {
  _headers(withAuth = true) {
    const h = { 'apikey': SUPABASE_ANON_KEY, 'Content-Type': 'application/json' };
    if (withAuth && tokenStore.accessToken) h['Authorization'] = 'Bearer ' + tokenStore.accessToken;
    return h;
  },
  // èªè¨¼: ãƒ­ã‚°ã‚¤ãƒ³
  async signIn(email, password) {
    const res = await fetch(SUPABASE_URL + '/auth/v1/token?grant_type=password', {
      method: 'POST', headers: this._headers(false),
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();
    if (!res.ok) return { user: null, error: data };
    tokenStore.save(data);
    return { user: data.user, error: null };
  },
  // èªè¨¼: ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—
  async getUser() {
    if (!tokenStore.accessToken) return null;
    const res = await fetch(SUPABASE_URL + '/auth/v1/user', { headers: this._headers() });
    if (!res.ok) { tokenStore.clear(); return null; }
    return await res.json();
  },
  // èªè¨¼: ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
  async signOut() {
    await fetch(SUPABASE_URL + '/auth/v1/logout', { method: 'POST', headers: this._headers() }).catch(() => {});
    tokenStore.clear();
  },
  // DB: SELECT
  async select(table, params = '') {
    const res = await fetch(SUPABASE_URL + '/rest/v1/' + table + '?select=*' + (params ? '&' + params : ''), { headers: this._headers() });
    if (!res.ok) return { data: null, error: await res.json() };
    return { data: await res.json(), error: null };
  },
  // DB: INSERT
  async insert(table, row) {
    const res = await fetch(SUPABASE_URL + '/rest/v1/' + table, {
      method: 'POST', headers: { ...this._headers(), 'Prefer': 'return=representation' },
      body: JSON.stringify(row)
    });
    if (!res.ok) return { data: null, error: await res.json() };
    const data = await res.json();
    return { data: data[0] || data, error: null };
  },
  // DB: UPDATE
  async update(table, filter, row) {
    const res = await fetch(SUPABASE_URL + '/rest/v1/' + table + '?' + filter, {
      method: 'PATCH', headers: { ...this._headers(), 'Prefer': 'return=representation' },
      body: JSON.stringify(row)
    });
    if (!res.ok) return { error: await res.json() };
    return { error: null };
  }
};

console.log('[Attract ATS] SUPABASE_READY:', SUPABASE_READY);

// Simple Icon component (replaces lucide-react)
function Icon({ name, size = 16, color = "currentColor", style: extraStyle }) {
  const icons = {
    home: "M3 12l9-9 9 9M5 10v10h4v-6h6v6h4V10",
    users: "M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2M9 7a4 4 0 100-8 4 4 0 000 8M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75",
    "git-branch": "M6 3v12M18 9a3 3 0 100-6 3 3 0 000 6zM6 21a3 3 0 100-6 3 3 0 000 6zM18 9a9 9 0 01-9 9",
    calendar: "M19 4H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V6a2 2 0 00-2-2zM16 2v4M8 2v4M3 10h18",
    "message-square": "M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",
    zap: "M13 2L3 14h9l-1 8 10-12h-9l1-8z",
    building: "M6 22V4a2 2 0 012-2h8a2 2 0 012 2v18zM6 12H4a2 2 0 00-2 2v6a2 2 0 002 2h2M18 9h2a2 2 0 012 2v9a2 2 0 01-2 2h-2M10 6h4M10 10h4M10 14h4M10 18h4",
    "bar-chart": "M12 20V10M18 20V4M6 20v-4",
    "check-square": "M9 11l3 3L22 4M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11",
    settings: "M12 15a3 3 0 100-6 3 3 0 000 6z",
    bell: "M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0",
    search: "M11 17.25a6.25 6.25 0 110-12.5 6.25 6.25 0 010 12.5zM16.65 16.65L21 21",
    "chevron-right": "M9 18l6-6-6-6",
    "arrow-left": "M19 12H5M12 19l-7-7 7-7",
    mic: "M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3zM19 10v2a7 7 0 01-14 0v-2M12 19v4M8 23h8",
    "mic-off": "M1 1l22 22M9 9v3a3 3 0 005.12 2.12M15 9.34V4a3 3 0 00-5.94-.6M17 16.95A7 7 0 015 12v-2m14 0v2c0 .76-.12 1.5-.34 2.18M12 19v4M8 23h8",
    mail: "M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2zM22 6l-10 7L2 6",
    phone: "M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72",
    "graduation-cap": "M22 10l-10-6L2 10l10 6 10-6zM6 12v5c3 3 9 3 12 0v-5",
    briefcase: "M20 7H4a2 2 0 00-2 2v10a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2zM16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16",
    star: "M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z",
    plus: "M12 5v14M5 12h14",
    "trending-up": "M23 6l-9.5 9.5-5-5L1 18",
    "trending-down": "M23 18l-9.5-9.5-5 5L1 6",
    "alert-circle": "M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 8v4M12 16h.01",
    "check-circle": "M22 11.08V12a10 10 0 11-5.93-9.14M22 4L12 14.01l-3-3",
    "file-text": "M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8zM14 2v6h6M16 13H8M16 17H8M10 9H8",
    volume: "M11 5L6 9H2v6h4l5 4V5zM19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07",
    user: "M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 7a4 4 0 100-8 4 4 0 000 8",
    filter: "M22 3H2l8 9.46V19l4 2v-8.54L22 3",
  };
  const path = icons[name] || icons["user"];
  return (
    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={{ display: "inline-block", verticalAlign: "middle", flexShrink: 0, ...extraStyle }}>
      {path.split("M").filter(Boolean).map((d, i) => <path key={i} d={"M" + d} />)}
    </svg>
  );
}

// ============================================================
// MOCK DATA - æ–°å’ + ä¸­é€”
// ============================================================
// ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¸ â†’ å€™è£œè€…ã‚¹ãƒ†ãƒ¼ã‚¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°
const PIPELINE_STAGE_MAP = {
  "ã‚¨ãƒ³ãƒˆãƒªãƒ¼": "ã‚¨ãƒ³ãƒˆãƒªãƒ¼",
  "èª¬æ˜ä¼š": "èª¬æ˜ä¼š",
  "äººäº‹é¢è«‡": "ä¸€æ¬¡é¢æ¥",
  "2æ¬¡é¸è€ƒ": "äºŒæ¬¡é¢æ¥",
  "å½¹å“¡é¢è«‡": "æœ€çµ‚é¢æ¥",
  "å†…å®š": "å†…å®š",
};
// é€†ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆå€™è£œè€…ã‚¹ãƒ†ãƒ¼ã‚¸ â†’ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¸åï¼‰
const CANDIDATE_TO_PIPELINE = {};
Object.entries(PIPELINE_STAGE_MAP).forEach(([k, v]) => { CANDIDATE_TO_PIPELINE[v] = k; });

const CANDIDATES = [
  // æ–°å’  â€» format: é¢æ¥ãƒ»é¸è€ƒã®å®Ÿæ–½å½¢æ…‹ï¼ˆ"WEB" / "å¯¾é¢" / nullï¼‰  â€» substatus: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…ã‚µãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  { id: 1, recruitType: "æ–°å’", lastName: "å±±ç”°", firstName: "èŠ±å­", university: "æ±äº¬å¤§å­¦", faculty: "çµŒæ¸ˆå­¦éƒ¨", gradYear: 2027, majorType: "æ–‡ç³»", company: null, position: null, experience: null, stage: "äºŒæ¬¡é¢æ¥", substatus: "äºˆç´„æ¸ˆ", status: "äºˆå®š", format: "å¯¾é¢", email: "hanako@example.com", phone: "090-1234-5678", route: "ãƒªã‚¯ãƒŠãƒ“", aspiration: 4, agent: "â—‹â—‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ", gender: "å¥³æ€§", score: 4.2, createdAt: "2026/01/15" },
  { id: 2, recruitType: "æ–°å’", lastName: "ä½è—¤", firstName: "å¤ªéƒ", university: "æ…¶æ‡‰ç¾©å¡¾å¤§å­¦", faculty: "æ³•å­¦éƒ¨", gradYear: 2027, majorType: "æ–‡ç³»", company: null, position: null, experience: null, stage: "ä¸€æ¬¡é¢æ¥", substatus: "åˆæ ¼", status: "é€šé", format: "WEB", email: "taro@example.com", phone: "090-2345-6789", route: "ãƒã‚¤ãƒŠãƒ“", aspiration: 5, agent: null, gender: "ç”·æ€§", score: 3.8, createdAt: "2026/01/18" },
  { id: 3, recruitType: "æ–°å’", lastName: "éˆ´æœ¨", firstName: "ç¾å’²", university: "æ—©ç¨²ç”°å¤§å­¦", faculty: "å•†å­¦éƒ¨", gradYear: 2027, majorType: "æ–‡ç³»", company: null, position: null, experience: null, stage: "èª¬æ˜ä¼š", substatus: "æ¡ˆå†…æ¸ˆ", status: "æ¡ˆå†…æ¸ˆ", format: null, email: "misaki@example.com", phone: "090-3456-7890", route: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ", aspiration: 3, agent: "â–³â–³äººæ", gender: "å¥³æ€§", score: null, createdAt: "2026/02/01" },
  { id: 4, recruitType: "æ–°å’", lastName: "ç”°ä¸­", firstName: "å¥ä¸€", university: "äº¬éƒ½å¤§å­¦", faculty: "å·¥å­¦éƒ¨", gradYear: 2027, majorType: "ç†ç³»", company: null, position: null, experience: null, stage: "æœ€çµ‚é¢æ¥", substatus: "äºˆç´„æ¸ˆ", status: "äºˆå®š", format: "å¯¾é¢", email: "kenichi@example.com", phone: "090-4567-8901", route: "ãƒªã‚¯ãƒŠãƒ“", aspiration: 5, agent: null, gender: "ç”·æ€§", score: 4.5, createdAt: "2026/01/10" },
  { id: 5, recruitType: "æ–°å’", lastName: "é«˜æ©‹", firstName: "ã•ãã‚‰", university: "ä¸Šæ™ºå¤§å­¦", faculty: "æ–‡å­¦éƒ¨", gradYear: 2027, majorType: "æ–‡ç³»", company: null, position: null, experience: null, stage: "å†…å®š", substatus: "æ‰¿è«¾", status: "æ‰¿è«¾å¾…ã¡", format: null, email: "sakura@example.com", phone: "090-5678-9012", route: "ãƒã‚¤ãƒŠãƒ“", aspiration: 5, agent: null, gender: "å¥³æ€§", score: 4.7, createdAt: "2025/12/20" },
  { id: 6, recruitType: "æ–°å’", lastName: "ä¼Šè—¤", firstName: "å¤§è¼", university: "æ±åŒ—å¤§å­¦", faculty: "ç†å­¦éƒ¨", gradYear: 2027, majorType: "ç†ç³»", company: null, position: null, experience: null, stage: "ã‚¨ãƒ³ãƒˆãƒªãƒ¼", substatus: "å—ä»˜æ¸ˆ", status: "æ–°è¦", format: null, email: "daiki@example.com", phone: "090-6789-0123", route: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ", aspiration: 2, agent: "â–¡â–¡ã‚­ãƒ£ãƒªã‚¢", gender: "ç”·æ€§", score: null, createdAt: "2026/02/24" },
  { id: 7, recruitType: "æ–°å’", lastName: "æ¸¡è¾º", firstName: "æ„›", university: "ä¸€æ©‹å¤§å­¦", faculty: "ç¤¾ä¼šå­¦éƒ¨", gradYear: 2027, majorType: "æ–‡ç³»", company: null, position: null, experience: null, stage: "ä¸€æ¬¡é¢æ¥", substatus: "æ¬ å¸­", status: "ä¸åˆæ ¼", format: "WEB", email: "ai@example.com", phone: "090-7890-1234", route: "ãƒªã‚¯ãƒŠãƒ“", aspiration: 3, agent: null, gender: "å¥³æ€§", score: 2.8, createdAt: "2026/01/22" },
  { id: 8, recruitType: "æ–°å’", lastName: "ä¸­æ‘", firstName: "ç¿”", university: "å¤§é˜ªå¤§å­¦", faculty: "çµŒæ¸ˆå­¦éƒ¨", gradYear: 2027, majorType: "æ–‡ç³»", company: null, position: null, experience: null, stage: "äºŒæ¬¡é¢æ¥", substatus: "åˆæ ¼", status: "é€šé", format: "WEB", email: "sho@example.com", phone: "090-8901-2345", route: "ãƒã‚¤ãƒŠãƒ“", aspiration: 4, agent: null, gender: "ç”·æ€§", score: 4.0, createdAt: "2026/01/12" },
  // æ–°å’è¿½åŠ ï¼ˆèª¬æ˜ä¼šãƒ•ãƒ­ãƒ¼ï¼‰
  { id: 15, recruitType: "æ–°å’", lastName: "è—¤ç”°", firstName: "å„ªèŠ±", university: "æ˜æ²»å¤§å­¦", faculty: "æ”¿æ²»çµŒæ¸ˆå­¦éƒ¨", gradYear: 2027, majorType: "æ–‡ç³»", company: null, position: null, experience: null, stage: "èª¬æ˜ä¼š", substatus: "æ¡ˆå†…æ¸ˆ", status: "æ¡ˆå†…æ¸ˆ", format: null, email: "yuka@example.com", phone: "090-1122-3344", route: "ãƒªã‚¯ãƒŠãƒ“", aspiration: 3, agent: null, gender: "å¥³æ€§", score: null, createdAt: "2026/02/20" },
  { id: 16, recruitType: "æ–°å’", lastName: "å±±å£", firstName: "æ‹“æµ·", university: "ç«‹å‘½é¤¨å¤§å­¦", faculty: "ç†å·¥å­¦éƒ¨", gradYear: 2027, majorType: "ç†ç³»", company: null, position: null, experience: null, stage: "èª¬æ˜ä¼š", substatus: "äºˆç´„æ¸ˆ", status: "äºˆç´„æ¸ˆ", format: "WEB", email: "takumi@example.com", phone: "090-2233-4455", route: "ãƒã‚¤ãƒŠãƒ“", aspiration: 4, agent: null, gender: "ç”·æ€§", score: null, createdAt: "2026/02/18" },
  { id: 17, recruitType: "æ–°å’", lastName: "çŸ³äº•", firstName: "ä¸ƒæµ·", university: "é’å±±å­¦é™¢å¤§å­¦", faculty: "çµŒå–¶å­¦éƒ¨", gradYear: 2027, majorType: "æ–‡ç³»", company: null, position: null, experience: null, stage: "èª¬æ˜ä¼š", substatus: "å‚åŠ ", status: "å‚åŠ æ¸ˆ", format: "WEB", email: "nanami@example.com", phone: "090-3344-5566", route: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ", aspiration: 4, agent: "â—‹â—‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ", gender: "å¥³æ€§", score: null, createdAt: "2026/02/10" },
  { id: 18, recruitType: "æ–°å’", lastName: "å‰ç”°", firstName: "é™¸", university: "ä¸­å¤®å¤§å­¦", faculty: "æ³•å­¦éƒ¨", gradYear: 2027, majorType: "æ–‡ç³»", company: null, position: null, experience: null, stage: "èª¬æ˜ä¼š", substatus: "æ¡ˆå†…æ¸ˆ", status: "æ¡ˆå†…æ¸ˆ", format: null, email: "riku@example.com", phone: "090-4455-6677", route: "ãƒªã‚¯ãƒŠãƒ“", aspiration: 2, agent: null, gender: "ç”·æ€§", score: null, createdAt: "2026/02/22" },
  { id: 19, recruitType: "æ–°å’", lastName: "å²¡ç”°", firstName: "ã‚ãŠã„", university: "æ³•æ”¿å¤§å­¦", faculty: "ç¤¾ä¼šå­¦éƒ¨", gradYear: 2027, majorType: "æ–‡ç³»", company: null, position: null, experience: null, stage: "èª¬æ˜ä¼š", substatus: "äºˆç´„æ¸ˆ", status: "äºˆç´„æ¸ˆ", format: "å¯¾é¢", email: "aoi@example.com", phone: "090-5566-7788", route: "ãƒã‚¤ãƒŠãƒ“", aspiration: 3, agent: null, gender: "å¥³æ€§", score: null, createdAt: "2026/02/19" },
  { id: 20, recruitType: "æ–°å’", lastName: "æ£®", firstName: "æ‚ æ–—", university: "ç­‘æ³¢å¤§å­¦", faculty: "æƒ…å ±å­¦ç¾¤", gradYear: 2027, majorType: "ç†ç³»", company: null, position: null, experience: null, stage: "ä¸€æ¬¡é¢æ¥", substatus: "æ¡ˆå†…æ¸ˆ", status: "æ¡ˆå†…æ¸ˆ", format: null, email: "yuto@example.com", phone: "090-6677-8899", route: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ", aspiration: 4, agent: "â–³â–³äººæ", gender: "ç”·æ€§", score: null, createdAt: "2026/02/15" },
  { id: 21, recruitType: "æ–°å’", lastName: "æ± ç”°", firstName: "çµè¡£", university: "ç¥æˆ¸å¤§å­¦", faculty: "çµŒæ¸ˆå­¦éƒ¨", gradYear: 2027, majorType: "æ–‡ç³»", company: null, position: null, experience: null, stage: "äºŒæ¬¡é¢æ¥", substatus: "æ¡ˆå†…æ¸ˆ", status: "æ¡ˆå†…æ¸ˆ", format: null, email: "yui@example.com", phone: "090-7788-9900", route: "ãƒªã‚¯ãƒŠãƒ“", aspiration: 5, agent: null, gender: "å¥³æ€§", score: null, createdAt: "2026/02/12" },
  { id: 22, recruitType: "æ–°å’", lastName: "åŸ", firstName: "è“®", university: "ä¹å·å¤§å­¦", faculty: "å·¥å­¦éƒ¨", gradYear: 2027, majorType: "ç†ç³»", company: null, position: null, experience: null, stage: "å†…å®š", substatus: "å†…å®šé€šçŸ¥", status: "å†…å®šé€šçŸ¥", format: null, email: "ren@example.com", phone: "090-8899-0011", route: "ãƒã‚¤ãƒŠãƒ“", aspiration: 4, agent: null, gender: "ç”·æ€§", score: 4.3, createdAt: "2026/01/08" },
  // ä¸­é€”
  { id: 9, recruitType: "ä¸­é€”", lastName: "æ¾æœ¬", firstName: "å¤§ä»‹", university: null, faculty: null, gradYear: null, majorType: null, company: "æ ªå¼ä¼šç¤¾ãƒªã‚¯ãƒ«ãƒ¼ãƒˆ", position: "å–¶æ¥­ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼", experience: 8, stage: "äºŒæ¬¡é¢æ¥", substatus: "äºˆç´„æ¸ˆ", status: "äºˆå®š", format: "å¯¾é¢", email: "daisuke@example.com", phone: "090-1111-2222", route: "ãƒ“ã‚ºãƒªãƒ¼ãƒ", aspiration: 4, agent: "â—â—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ", gender: "ç”·æ€§", score: 4.3, createdAt: "2026/02/10" },
  { id: 10, recruitType: "ä¸­é€”", lastName: "å°æ—", firstName: "ç”±ç¾", university: null, faculty: null, gradYear: null, majorType: null, company: "ã‚¢ã‚¯ã‚»ãƒ³ãƒãƒ¥ã‚¢æ ªå¼ä¼šç¤¾", position: "ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ", experience: 5, stage: "ä¸€æ¬¡é¢æ¥", substatus: "åˆæ ¼", status: "é€šé", format: "WEB", email: "yumi@example.com", phone: "090-2222-3333", route: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ", aspiration: 5, agent: "â˜…â˜…ã‚­ãƒ£ãƒªã‚¢", gender: "å¥³æ€§", score: 4.1, createdAt: "2026/02/05" },
  { id: 11, recruitType: "ä¸­é€”", lastName: "åŠ è—¤", firstName: "ç¿”å¤ª", university: null, faculty: null, gradYear: null, majorType: null, company: "ã‚µã‚¤ãƒãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ", position: "Webã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢", experience: 3, stage: "èª¬æ˜ä¼š", substatus: "å‚åŠ ", status: "å‚åŠ æ¸ˆ", format: "WEB", email: "shota@example.com", phone: "090-3333-4444", route: "Green", aspiration: 3, agent: null, gender: "ç”·æ€§", score: null, createdAt: "2026/02/15" },
  { id: 12, recruitType: "ä¸­é€”", lastName: "æœ¨æ‘", firstName: "éº»è¡£", university: null, faculty: null, gradYear: null, majorType: null, company: "ãƒ‡ãƒ­ã‚¤ãƒˆãƒˆãƒ¼ãƒãƒ„", position: "ã‚·ãƒ‹ã‚¢ã‚¢ãƒŠãƒªã‚¹ãƒˆ", experience: 6, stage: "æœ€çµ‚é¢æ¥", substatus: "äºˆç´„æ¸ˆ", status: "äºˆå®š", format: "å¯¾é¢", email: "mai@example.com", phone: "090-4444-5555", route: "ãƒ“ã‚ºãƒªãƒ¼ãƒ", aspiration: 5, agent: null, gender: "å¥³æ€§", score: 4.6, createdAt: "2026/01/28" },
  { id: 13, recruitType: "ä¸­é€”", lastName: "å‰ç”°", firstName: "å¥å¤ª", university: null, faculty: null, gradYear: null, majorType: null, company: "æ¥½å¤©ã‚°ãƒ«ãƒ¼ãƒ—", position: "ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼", experience: 10, stage: "ã‚¨ãƒ³ãƒˆãƒªãƒ¼", substatus: "å—ä»˜æ¸ˆ", status: "æ–°è¦", format: null, email: "kenta@example.com", phone: "090-5555-6666", route: "ãƒªãƒ•ã‚¡ãƒ©ãƒ«", aspiration: 4, agent: null, gender: "ç”·æ€§", score: null, createdAt: "2026/02/22" },
  { id: 14, recruitType: "ä¸­é€”", lastName: "æ–‰è—¤", firstName: "ã‚ã‹ã‚Š", university: null, faculty: null, gradYear: null, majorType: null, company: "ãƒ‘ãƒ¼ã‚½ãƒ«ã‚­ãƒ£ãƒªã‚¢", position: "äººäº‹", experience: 4, stage: "å†…å®š", substatus: "æ‰¿è«¾", status: "æ‰¿è«¾å¾…ã¡", format: null, email: "akari@example.com", phone: "090-6666-7777", route: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ", aspiration: 5, agent: "â—â—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ", gender: "å¥³æ€§", score: 4.4, createdAt: "2026/01/05" },
  { id: 23, recruitType: "ä¸­é€”", lastName: "è¥¿æ‘", firstName: "å¥", university: null, faculty: null, gradYear: null, majorType: null, company: "ãƒãƒƒã‚­ãƒ³ã‚¼ãƒ¼", position: "ã‚¢ã‚½ã‚·ã‚¨ã‚¤ãƒˆ", experience: 4, stage: "èª¬æ˜ä¼š", substatus: "æ¡ˆå†…æ¸ˆ", status: "æ¡ˆå†…æ¸ˆ", format: null, email: "ken@example.com", phone: "090-9900-1122", route: "ãƒ“ã‚ºãƒªãƒ¼ãƒ", aspiration: 3, agent: null, gender: "ç”·æ€§", score: null, createdAt: "2026/02/21" },
];

const PIPELINE_STAGES = [
  { name: "ã‚¨ãƒ³ãƒˆãƒªãƒ¼", count: 751, active: 45, color: "#6366f1" },
  { name: "æ›¸é¡é¸è€ƒ", count: 680, active: 38, color: "#8b5cf6" },
  { name: "ä¸€æ¬¡é¢æ¥", count: 420, active: 22, color: "#a855f7" },
  { name: "äºŒæ¬¡é¢æ¥", count: 185, active: 15, color: "#d946ef" },
  { name: "æœ€çµ‚é¢æ¥", count: 85, active: 8, color: "#ec4899" },
  { name: "å†…å®š", count: 12, active: 6, color: "#f43f5e" },
  { name: "å†…å®šæ‰¿è«¾", count: 5, active: 5, color: "#10b981" },
];

const FUNNEL_DATA = [
  { stage: "ã‚¨ãƒ³ãƒˆãƒªãƒ¼", value: 751 },
  { stage: "æ›¸é¡é¸è€ƒ", value: 680 },
  { stage: "ä¸€æ¬¡é¢æ¥", value: 420 },
  { stage: "äºŒæ¬¡é¢æ¥", value: 185 },
  { stage: "æœ€çµ‚é¢æ¥", value: 85 },
  { stage: "å†…å®š", value: 12 },
  { stage: "å†…å®šæ‰¿è«¾", value: 5 },
];

const MONTHLY_TREND = [
  { month: "10æœˆ", entries: 45, passes: 30, offers: 0 },
  { month: "11æœˆ", entries: 82, passes: 55, offers: 0 },
  { month: "12æœˆ", entries: 120, passes: 78, offers: 1 },
  { month: "1æœˆ", entries: 210, passes: 145, offers: 3 },
  { month: "2æœˆ", entries: 180, passes: 120, offers: 5 },
  { month: "3æœˆ", entries: 114, passes: 0, offers: 3 },
];

const EVALUATOR_BIAS = [
  { name: "å®‰å²¡", avg: 3.8, passRate: 72, tendency: "å¹³å‡", variance: 0.8, count: 45 },
  { name: "éˆ´æœ¨", avg: 4.2, passRate: 85, tendency: "ç”˜ã‚", variance: 0.5, count: 38 },
  { name: "ç”°ä¸­éƒ¨é•·", avg: 3.2, passRate: 55, tendency: "è¾›ã‚", variance: 1.2, count: 22 },
  { name: "ä½è—¤", avg: 3.9, passRate: 70, tendency: "å¹³å‡", variance: 0.6, count: 30 },
];

const RADAR_DATA = [
  { subject: "ã‚³ãƒŸãƒ¥åŠ›", a: 3.8, b: 4.5, c: 3.2 },
  { subject: "è«–ç†åŠ›", a: 4.0, b: 3.5, c: 4.3 },
  { subject: "å¿—æœ›åº¦", a: 3.5, b: 4.3, c: 2.8 },
  { subject: "é©æ€§", a: 3.8, b: 4.0, c: 3.5 },
  { subject: "ã‚¹ã‚­ãƒ«", a: 4.0, b: 4.2, c: 3.0 },
];

const AUTOMATION_TRIGGERS = [
  { id: 1, name: "ã‚¨ãƒ³ãƒˆãƒªãƒ¼å®Œäº† â†’ ã‚µãƒ³ã‚¯ã‚¹ãƒ¡ãƒ¼ãƒ«", trigger: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œã‚¨ãƒ³ãƒˆãƒªãƒ¼ã€ã«å¤‰æ›´", target: "å€™è£œè€…", delay: "å³æ™‚", channels: ["ãƒ¡ãƒ¼ãƒ«", "LINE"], active: true },
  { id: 2, name: "æ›¸é¡é¸è€ƒé€šé â†’ ä¸€æ¬¡é¢æ¥æ¡ˆå†…", trigger: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œæ›¸é¡é¸è€ƒé€šéã€ã«å¤‰æ›´", target: "å€™è£œè€…", delay: "30åˆ†å¾Œ", channels: ["ãƒ¡ãƒ¼ãƒ«", "LINE"], active: true },
  { id: 3, name: "é¢æ¥å‰æ—¥ãƒªãƒã‚¤ãƒ³ãƒ‰", trigger: "é¢æ¥äºˆå®šæ—¥ã®24æ™‚é–“å‰", target: "å€™è£œè€… + é¢æ¥å®˜", delay: "è‡ªå‹•", channels: ["ãƒ¡ãƒ¼ãƒ«", "LINE"], active: true },
  { id: 4, name: "é¢æ¥ç›´å‰ãƒªãƒã‚¤ãƒ³ãƒ‰", trigger: "é¢æ¥äºˆå®šæ—¥ã®1æ™‚é–“å‰", target: "å€™è£œè€… + é¢æ¥å®˜", delay: "è‡ªå‹•", channels: ["LINE"], active: true },
  { id: 5, name: "ä¸åˆæ ¼é€šçŸ¥", trigger: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œä¸åˆæ ¼ã€ã«å¤‰æ›´", target: "å€™è£œè€…", delay: "1æ™‚é–“å¾Œ", channels: ["ãƒ¡ãƒ¼ãƒ«"], active: true },
  { id: 6, name: "FBæœªå…¥åŠ›ãƒªãƒã‚¤ãƒ³ãƒ‰", trigger: "é¢æ¥å®Œäº†å¾Œ24æ™‚é–“ã€FBãŒæœªå…¥åŠ›", target: "é¢æ¥å®˜", delay: "24æ™‚é–“ã”ã¨", channels: ["ãƒ¡ãƒ¼ãƒ«"], active: true },
  { id: 7, name: "å†…å®šé€šçŸ¥", trigger: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œå†…å®šã€ã«å¤‰æ›´", target: "å€™è£œè€…", delay: "å³æ™‚", channels: ["ãƒ¡ãƒ¼ãƒ«", "LINE"], active: false },
];

const COLORS = ["#6366f1", "#8b5cf6", "#a855f7", "#d946ef", "#ec4899", "#f43f5e", "#10b981"];

// ============================================================
// ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
// ============================================================
function LoginPage({ onLogin }) {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState(null);
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError(null);
    if (SUPABASE_READY) {
      const { user, error: authError } = await sbApi.signIn(email, password);
      if (authError) {
        setError("ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: " + (authError.error_description || authError.msg || JSON.stringify(authError)));
        setLoading(false);
        return;
      }
      onLogin(user);
    } else {
      // ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ï¼ˆSupabaseæœªè¨­å®šæ™‚ï¼‰
      if (email && password) {
        onLogin({ email, id: "demo" });
      } else {
        setError("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      }
      setLoading(false);
    }
  };

  return (
    <div style={{ minHeight: "100vh", display: "flex", alignItems: "center", justifyContent: "center", background: "linear-gradient(135deg, #0d2eb5 0%, #1d4aff 50%, #3562f6 100%)" }}>
      <div style={{ background: "white", borderRadius: 20, padding: "48px 40px", width: 400, boxShadow: "0 20px 60px rgba(0,0,0,0.3)" }}>
        <div style={{ textAlign: "center", marginBottom: 32 }}>
          <img src="logo.svg" alt="Attract" style={{ width: 200, marginBottom: 4, filter: "brightness(0) saturate(100%) invert(22%) sepia(93%) saturate(4000%) hue-rotate(228deg) brightness(100%) contrast(102%)" }} />
          <div style={{ fontSize: 13, color: "#6b7280" }}>æ¡ç”¨ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </div>
        </div>
        <form onSubmit={handleSubmit}>
          <div style={{ marginBottom: 16 }}>
            <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "#374151", marginBottom: 6 }}>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
            <input type="email" value={email} onChange={e => setEmail(e.target.value)} placeholder="you@example.com"
              style={{ width: "100%", padding: "10px 14px", border: "1px solid #d1d5db", borderRadius: 10, fontSize: 14, outline: "none", boxSizing: "border-box" }} />
          </div>
          <div style={{ marginBottom: 24 }}>
            <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "#374151", marginBottom: 6 }}>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
            <input type="password" value={password} onChange={e => setPassword(e.target.value)} placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›"
              style={{ width: "100%", padding: "10px 14px", border: "1px solid #d1d5db", borderRadius: 10, fontSize: 14, outline: "none", boxSizing: "border-box" }} />
          </div>
          {error && (
            <div style={{ padding: "10px 14px", background: "#fef2f2", border: "1px solid #fecaca", borderRadius: 8, color: "#dc2626", fontSize: 12, marginBottom: 16 }}>{error}</div>
          )}
          <button type="submit" disabled={loading}
            style={{ width: "100%", padding: "12px", background: loading ? "#a5b4fc" : "#4338ca", color: "white", border: "none", borderRadius: 10, fontSize: 14, fontWeight: 600, cursor: loading ? "default" : "pointer" }}>
            {loading ? "ãƒ­ã‚°ã‚¤ãƒ³ä¸­..." : "ãƒ­ã‚°ã‚¤ãƒ³"}
          </button>
        </form>
        {!SUPABASE_READY && (
          <div style={{ marginTop: 20, padding: "12px 14px", background: "#fefce8", border: "1px solid #fde68a", borderRadius: 8, fontSize: 11, color: "#92400e" }}>
            <strong>ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰:</strong> Supabaseæœªæ¥ç¶šã®ãŸã‚ã€ä»»æ„ã®ãƒ¡ãƒ¼ãƒ«ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚
          </div>
        )}
      </div>
    </div>
  );
}

// ============================================================
// ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ãƒƒã‚¯
// ============================================================
function useSupabaseCandidates(recruitFilter) {
  const [candidates, setCandidates] = useState(CANDIDATES);
  const [loading, setLoading] = useState(false);

  const fetchCandidates = useCallback(async () => {
    if (!SUPABASE_READY) { setCandidates(CANDIDATES); return; }
    setLoading(true);
    let params = 'order=created_at.desc';
    if (recruitFilter !== 'all') params += '&recruit_type=eq.' + encodeURIComponent(recruitFilter);
    const { data, error } = await sbApi.select('candidates', params);
    if (!error && data) {
      // DB ã®ã‚«ãƒ©ãƒ å â†’ ãƒ•ãƒ­ãƒ³ãƒˆã®ã‚­ãƒ¼åã«ãƒãƒƒãƒ”ãƒ³ã‚°
      setCandidates(data.map(r => ({
        id: r.id,
        recruitType: r.recruit_type,
        lastName: r.last_name,
        firstName: r.first_name,
        university: r.university,
        faculty: r.faculty,
        gradYear: r.grad_year,
        majorType: r.major_type,
        company: r.company,
        position: r.position,
        experience: r.experience,
        stage: r.stage,
        substatus: r.substatus,
        status: r.status,
        format: r.format,
        email: r.email,
        phone: r.phone,
        route: r.route,
        aspiration: r.aspiration,
        agent: r.agent,
        gender: r.gender,
        score: r.score ? parseFloat(r.score) : null,
        createdAt: new Date(r.created_at).toLocaleDateString('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/-/g, '/'),
        entryDate: r.entry_date || null,
        birthDate: r.birth_date || null,
        graduationPeriod: r.graduation_period || null,
        department: r.department || null,
        lastNameKana: r.last_name_kana || null,
        firstNameKana: r.first_name_kana || null,
        notes: r.notes || null,
        stageDate: r.stage_date || null,
        originalStage: r.original_stage || null,
      })));
    }
    setLoading(false);
  }, [recruitFilter]);

  useEffect(() => { fetchCandidates(); }, [fetchCandidates]);

  const addCandidate = async (newCandidate) => {
    if (!SUPABASE_READY) {
      const maxId = Math.max(...candidates.map(c => c.id));
      const withId = { ...newCandidate, id: maxId + 1, createdAt: new Date().toLocaleDateString('ja-JP').replace(/-/g, '/') };
      setCandidates(prev => [withId, ...prev]);
      return withId;
    }
    const { data, error } = await sbApi.insert('candidates', {
      recruit_type: newCandidate.recruitType,
      last_name: newCandidate.lastName,
      first_name: newCandidate.firstName,
      last_name_kana: newCandidate.lastNameKana || null,
      first_name_kana: newCandidate.firstNameKana || null,
      university: newCandidate.university || null,
      faculty: newCandidate.faculty || null,
      department: newCandidate.department || null,
      grad_year: newCandidate.gradYear || null,
      major_type: newCandidate.majorType || null,
      graduation_period: newCandidate.graduationPeriod || null,
      company: newCandidate.company || null,
      position: newCandidate.position || null,
      experience: newCandidate.experience || null,
      stage: newCandidate.stage || 'ã‚¨ãƒ³ãƒˆãƒªãƒ¼/å—ä»˜æ¸ˆ',
      substatus: newCandidate.substatus || 'å—ä»˜æ¸ˆ',
      status: newCandidate.status || 'æ–°è¦',
      format: newCandidate.format || null,
      email: newCandidate.email || null,
      phone: newCandidate.phone || null,
      route: newCandidate.route || null,
      aspiration: newCandidate.aspiration || 3,
      agent: newCandidate.agent || null,
      gender: newCandidate.gender || null,
      birth_date: newCandidate.birthDate || null,
      entry_date: newCandidate.entryDate || null,
      notes: newCandidate.notes || null,
    });
    if (!error) await fetchCandidates();
    return data;
  };

  const updateCandidate = async (id, updates) => {
    if (!SUPABASE_READY) {
      setCandidates(prev => prev.map(c => c.id === id ? { ...c, ...updates } : c));
      return;
    }
    // camelCase â†’ snake_case
    const dbUpdates = {};
    if (updates.stage !== undefined) dbUpdates.stage = updates.stage;
    if (updates.substatus !== undefined) dbUpdates.substatus = updates.substatus;
    if (updates.status !== undefined) dbUpdates.status = updates.status;
    if (updates.format !== undefined) dbUpdates.format = updates.format;
    if (updates.score !== undefined) dbUpdates.score = updates.score;
    if (updates.aspiration !== undefined) dbUpdates.aspiration = updates.aspiration;
    await sbApi.update('candidates', 'id=eq.' + id, dbUpdates);
    await fetchCandidates();
  };

  const bulkUpdateStatus = async (ids, newStatus) => {
    if (!SUPABASE_READY) {
      setCandidates(prev => prev.map(c => ids.has(c.id) ? { ...c, status: newStatus } : c));
      return;
    }
    const idList = Array.from(ids).join(',');
    await sbApi.update('candidates', 'id=in.(' + idList + ')', { status: newStatus });
    await fetchCandidates();
  };

  return { candidates, loading, addCandidate, updateCandidate, bulkUpdateStatus, refresh: fetchCandidates };
}

// ============================================================
// æ¡ç”¨åŒºåˆ†ã‚¿ãƒ–ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼‰
// ============================================================
function RecruitTypeSelector({ value, onChange }) {
  const types = [
    { id: "all", label: "å…¨ä½“", icon: "users" },
    { id: "æ–°å’", label: "æ–°å’", icon: "graduation-cap" },
    { id: "ä¸­é€”", label: "ä¸­é€”", icon: "briefcase" },
  ];
  return (
    <div style={{ display: "flex", gap: 2, background: "#eef2ff", borderRadius: 8, padding: 3 }}>
      {types.map(t => (
        <button key={t.id} onClick={() => onChange(t.id)}
          style={{ display: "flex", alignItems: "center", gap: 5, padding: "5px 14px", border: "none", borderRadius: 6, fontSize: 12, cursor: "pointer",
            background: value === t.id ? "#4338ca" : "transparent",
            color: value === t.id ? "white" : "#6366f1",
            fontWeight: value === t.id ? 600 : 400, transition: "all 0.15s" }}>
          <Icon name={t.icon} size={13} color={value === t.id ? "white" : "#6366f1"} />
          {t.label}
        </button>
      ))}
    </div>
  );
}

// ============================================================
// COMPONENTS
// ============================================================
function Sidebar({ currentPage, onNavigate }) {
  const items = [
    { id: "dashboard", icon: "home", label: "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰" },
    { id: "candidates", icon: "users", label: "å€™è£œè€…ç®¡ç†" },
    { id: "pipeline", icon: "git-branch", label: "é¸è€ƒãƒ•ãƒ­ãƒ¼" },
    { id: "schedule", icon: "calendar", label: "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«" },
    { id: "messages", icon: "message-square", label: "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸" },
    { id: "automation", icon: "zap", label: "è‡ªå‹•åŒ–è¨­å®š" },
    { id: "agents", icon: "building", label: "ç´¹ä»‹ä¼šç¤¾" },
    { id: "analytics", icon: "bar-chart", label: "åˆ†æ" },
    { id: "tasks", icon: "check-square", label: "ã‚¿ã‚¹ã‚¯" },
    { id: "settings", icon: "settings", label: "è¨­å®š" },
  ];
  return (
    <div style={{ width: 220, background: "#0a1632", color: "white", display: "flex", flexDirection: "column", minHeight: "100vh", flexShrink: 0 }}>
      <div style={{ padding: "18px 14px 14px", borderBottom: "1px solid rgba(255,255,255,0.08)" }}>
        <img src="logo.svg" alt="Attract" style={{ width: "100%", maxWidth: 170, display: "block" }} />
      </div>
      <nav style={{ flex: 1, padding: "8px 0" }}>
        {items.map(item => (
          <button key={item.id} onClick={() => onNavigate(item.id)}
            style={{ width: "100%", display: "flex", alignItems: "center", gap: 10, padding: "10px 16px", border: "none", background: currentPage === item.id ? "#1d4aff" : "transparent", color: currentPage === item.id ? "white" : "rgba(255,255,255,0.6)", cursor: "pointer", fontSize: 13, textAlign: "left", transition: "all 0.15s", borderRadius: currentPage === item.id ? 0 : 0 }}>
            <Icon name={item.icon} size={18} color={currentPage === item.id ? "white" : "rgba(255,255,255,0.6)"} />
            <span>{item.label}</span>
          </button>
        ))}
      </nav>
      <div style={{ padding: "12px 16px", borderTop: "1px solid rgba(255,255,255,0.08)", display: "flex", alignItems: "center", gap: 8 }}>
        <div style={{ width: 32, height: 32, borderRadius: "50%", background: "#1d4aff", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 12, fontWeight: 600 }}>å®‰</div>
        <div>
          <div style={{ fontSize: 12, fontWeight: 500 }}>å®‰å²¡ å°šå’Œ</div>
          <div style={{ fontSize: 10, color: "rgba(255,255,255,0.4)" }}>ç®¡ç†è€…</div>
        </div>
      </div>
    </div>
  );
}

function KpiCard({ label, value, change, changeType, iconName, color }) {
  return (
    <div style={{ background: "white", borderRadius: 12, padding: "18px 20px", boxShadow: "0 1px 3px rgba(0,0,0,0.08)", flex: 1, minWidth: 160 }}>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start" }}>
        <div>
          <div style={{ fontSize: 12, color: "#6b7280", marginBottom: 4 }}>{label}</div>
          <div style={{ fontSize: 28, fontWeight: 700, color: "#111827" }}>{value}</div>
        </div>
        <div style={{ width: 40, height: 40, borderRadius: 10, background: color + "18", display: "flex", alignItems: "center", justifyContent: "center" }}>
          <Icon name={iconName} size={20} color={color} />
        </div>
      </div>
      {change !== undefined && (
        <div style={{ fontSize: 11, marginTop: 8, display: "flex", alignItems: "center", gap: 4, color: changeType === "up" ? "#10b981" : changeType === "down" ? "#ef4444" : "#6b7280" }}>
          {changeType === "up" ? <Icon name="trending-up" size={12} /> : changeType === "down" ? <Icon name="trending-down" size={12} /> : null}
          {change} ä»Šé€±
        </div>
      )}
    </div>
  );
}

// æ¡ç”¨åŒºåˆ†ãƒãƒƒã‚¸
function RecruitTypeBadge({ type }) {
  const isNew = type === "æ–°å’";
  return (
    <span style={{ fontSize: 10, fontWeight: 600, padding: "2px 8px", borderRadius: 10,
      background: isNew ? "#dbeafe" : "#fef3c7",
      color: isNew ? "#1d4ed8" : "#92400e" }}>
      {type}
    </span>
  );
}

// WEB/å¯¾é¢ãƒãƒƒã‚¸
function FormatBadge({ format }) {
  if (!format) return null;
  const isWeb = format === "WEB";
  return (
    <span style={{ fontSize: 10, fontWeight: 600, padding: "2px 8px", borderRadius: 10,
      background: isWeb ? "#ecfdf5" : "#fdf2f8",
      color: isWeb ? "#065f46" : "#9d174d",
      display: "inline-flex", alignItems: "center", gap: 3 }}>
      {isWeb ? "ğŸ’»" : "ğŸ¢"} {format}
    </span>
  );
}

// ============================================================
// PAGES
// ============================================================

function DashboardPage({ onNavigate, recruitFilter }) {
  const filteredCandidates = recruitFilter === "all" ? CANDIDATES : CANDIDATES.filter(c => c.recruitType === recruitFilter);
  const newCount = CANDIDATES.filter(c => c.recruitType === "æ–°å’").length;
  const midCount = CANDIDATES.filter(c => c.recruitType === "ä¸­é€”").length;
  return (
    <div style={{ padding: 24, maxWidth: 1200 }}>
      <h1 style={{ fontSize: 22, fontWeight: 700, color: "#111827", marginBottom: 20 }}>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
      <div style={{ display: "flex", gap: 16, marginBottom: 24, flexWrap: "wrap" }}>
        <KpiCard label="ã‚¨ãƒ³ãƒˆãƒªãƒ¼ç·è¨ˆ" value="751" change="+12" changeType="up" iconName="users" color="#6366f1" />
        <KpiCard label="é¸è€ƒä¸­" value="540" change="-3" changeType="down" iconName="git-branch" color="#8b5cf6" />
        <KpiCard label="å†…å®š" value="6" change="+1" changeType="up" iconName="check-circle" color="#10b981" />
        <KpiCard label="å†…å®šæ‰¿è«¾" value="5" change="Â±0" changeType="neutral" iconName="star" color="#f59e0b" />
      </div>

      {/* æ¡ç”¨åŒºåˆ†åˆ¥ã‚µãƒãƒªãƒ¼ */}
      <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16, marginBottom: 24 }}>
        <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
          <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16, display: "flex", alignItems: "center", gap: 6 }}>
            <Icon name="alert-circle" size={16} color="#f59e0b" /> ä»Šæ—¥ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
          </h3>
          {[
            { icon: "ğŸ”´", text: "é¢æ¥FBæœªå…¥åŠ›", count: "3ä»¶", action: "å…¥åŠ›ã™ã‚‹" },
            { icon: "ğŸŸ¡", text: "ãƒªãƒã‚¤ãƒ³ãƒ‰é€ä¿¡å¾…ã¡", count: "5ä»¶", action: "ç¢ºèª" },
            { icon: "ğŸŸ¢", text: "ä»Šæ—¥ã®é¢æ¥", count: "2ä»¶", action: "è©³ç´°" },
            { icon: "âšª", text: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ‰¿èªå¾…ã¡", count: "1ä»¶", action: "æ‰¿èª" },
          ].map((item, i) => (
            <div key={i} style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "10px 0", borderBottom: i < 3 ? "1px solid #f3f4f6" : "none" }}>
              <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                <span>{item.icon}</span>
                <span style={{ fontSize: 13, color: "#374151" }}>{item.text}</span>
                <span style={{ fontSize: 12, fontWeight: 600, color: "#6366f1" }}>{item.count}</span>
              </div>
              <button style={{ fontSize: 11, color: "#6366f1", background: "#eef2ff", border: "none", borderRadius: 6, padding: "4px 10px", cursor: "pointer" }}>{item.action}</button>
            </div>
          ))}
        </div>
        <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
          <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16, display: "flex", alignItems: "center", gap: 6 }}>
            <Icon name="bar-chart" size={16} color="#6366f1" /> é¸è€ƒãƒ•ã‚¡ãƒãƒ«
          </h3>
          <ResponsiveContainer width="100%" height={200}>
            <BarChart data={FUNNEL_DATA} layout="vertical" margin={{ left: 60 }}>
              <XAxis type="number" hide />
              <YAxis type="category" dataKey="stage" tick={{ fontSize: 11 }} width={60} />
              <Tooltip />
              <Bar dataKey="value" radius={[0, 6, 6, 0]}>
                {FUNNEL_DATA.map((_, i) => <Cell key={i} fill={COLORS[i]} />)}
              </Bar>
            </BarChart>
          </ResponsiveContainer>
        </div>
      </div>

      {/* æ¡ç”¨åŒºåˆ†åˆ¥ã®å€™è£œè€…æ•° */}
      <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)", marginBottom: 24 }}>
        <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>æ¡ç”¨åŒºåˆ†åˆ¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
          <div style={{ padding: 16, background: "#eef2ff", borderRadius: 10, border: "1px solid #c7d2fe" }}>
            <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 12 }}>
              <Icon name="graduation-cap" size={18} color="#4338ca" />
              <span style={{ fontSize: 14, fontWeight: 600, color: "#4338ca" }}>æ–°å’æ¡ç”¨</span>
              <span style={{ fontSize: 22, fontWeight: 700, color: "#4338ca", marginLeft: "auto" }}>{newCount}å</span>
            </div>
            <div style={{ display: "flex", gap: 8, fontSize: 11 }}>
              <span style={{ padding: "2px 8px", borderRadius: 8, background: "#dbeafe", color: "#1d4ed8" }}>é¸è€ƒä¸­ 6</span>
              <span style={{ padding: "2px 8px", borderRadius: 8, background: "#dcfce7", color: "#15803d" }}>å†…å®š 1</span>
              <span style={{ padding: "2px 8px", borderRadius: 8, background: "#fee2e2", color: "#dc2626" }}>ä¸åˆæ ¼ 1</span>
            </div>
          </div>
          <div style={{ padding: 16, background: "#fffbeb", borderRadius: 10, border: "1px solid #fde68a" }}>
            <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 12 }}>
              <Icon name="briefcase" size={18} color="#92400e" />
              <span style={{ fontSize: 14, fontWeight: 600, color: "#92400e" }}>ä¸­é€”æ¡ç”¨</span>
              <span style={{ fontSize: 22, fontWeight: 700, color: "#92400e", marginLeft: "auto" }}>{midCount}å</span>
            </div>
            <div style={{ display: "flex", gap: 8, fontSize: 11 }}>
              <span style={{ padding: "2px 8px", borderRadius: 8, background: "#fef3c7", color: "#92400e" }}>é¸è€ƒä¸­ 4</span>
              <span style={{ padding: "2px 8px", borderRadius: 8, background: "#dcfce7", color: "#15803d" }}>å†…å®š 1</span>
              <span style={{ padding: "2px 8px", borderRadius: 8, background: "#f3f4f6", color: "#6b7280" }}>æ–°è¦ 1</span>
            </div>
          </div>
        </div>
      </div>

      <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
        <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
          <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16, display: "flex", alignItems: "center", gap: 6 }}>
            <Icon name="calendar" size={16} color="#6366f1" /> ç›´è¿‘ã®é¢æ¥äºˆå®š
          </h3>
          {[
            { time: "14:00", name: "å±±ç”° èŠ±å­", stage: "äºŒæ¬¡é¢æ¥", interviewer: "å®‰å²¡", type: "æ–°å’", format: "å¯¾é¢" },
            { time: "15:30", name: "æ¾æœ¬ å¤§ä»‹", stage: "äºŒæ¬¡é¢æ¥", interviewer: "éˆ´æœ¨", type: "ä¸­é€”", format: "å¯¾é¢" },
            { time: "16:00", name: "ç”°ä¸­ å¥ä¸€", stage: "æœ€çµ‚é¢æ¥", interviewer: "ç”°ä¸­éƒ¨é•·", type: "æ–°å’", format: "å¯¾é¢" },
          ].map((item, i) => (
            <div key={i} style={{ display: "flex", alignItems: "center", gap: 12, padding: "12px 0", borderBottom: i < 2 ? "1px solid #f3f4f6" : "none" }}>
              <div style={{ width: 44, height: 44, borderRadius: 10, background: "#eef2ff", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 12, fontWeight: 600, color: "#4338ca" }}>{item.time}</div>
              <div style={{ flex: 1 }}>
                <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                  <span style={{ fontSize: 13, fontWeight: 600, color: "#111827" }}>{item.name}</span>
                  <RecruitTypeBadge type={item.type} />
                  <FormatBadge format={item.format} />
                </div>
                <div style={{ fontSize: 11, color: "#6b7280" }}>{item.stage} ãƒ» é¢æ¥å®˜: {item.interviewer}</div>
              </div>
              <button onClick={() => onNavigate("interview-fb")} style={{ fontSize: 11, color: "white", background: "#6366f1", border: "none", borderRadius: 6, padding: "6px 12px", cursor: "pointer" }}>FBå…¥åŠ›</button>
            </div>
          ))}
        </div>
        <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
          <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16, display: "flex", alignItems: "center", gap: 6 }}>
            <Icon name="bell" size={16} color="#6366f1" /> æœ€æ–°ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£
          </h3>
          {[
            { text: "ç”°ä¸­å¥ä¸€ãŒä¸€æ¬¡é¢æ¥é€šé", time: "15åˆ†å‰", type: "pass", recruit: "æ–°å’" },
            { text: "å°æ—ç”±ç¾ãŒä¸€æ¬¡é¢æ¥é€šé", time: "30åˆ†å‰", type: "pass", recruit: "ä¸­é€”" },
            { text: "â—‹â—‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒ3åç™»éŒ²", time: "3æ™‚é–“å‰", type: "entry", recruit: null },
            { text: "æœ¨æ‘éº»è¡£ã®æœ€çµ‚é¢æ¥ã‚’äºˆç´„", time: "5æ™‚é–“å‰", type: "schedule", recruit: "ä¸­é€”" },
          ].map((item, i) => (
            <div key={i} style={{ display: "flex", alignItems: "flex-start", gap: 10, padding: "10px 0", borderBottom: i < 3 ? "1px solid #f3f4f6" : "none" }}>
              <div style={{ width: 6, height: 6, borderRadius: "50%", background: item.type === "pass" ? "#10b981" : item.type === "fb" ? "#6366f1" : item.type === "entry" ? "#f59e0b" : "#8b5cf6", marginTop: 5, flexShrink: 0 }} />
              <div style={{ flex: 1 }}>
                <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                  <span style={{ fontSize: 13, color: "#374151" }}>{item.text}</span>
                  {item.recruit && <RecruitTypeBadge type={item.recruit} />}
                </div>
                <div style={{ fontSize: 11, color: "#9ca3af" }}>{item.time}</div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

// Candidates List - æ–°å’/ä¸­é€”å¯¾å¿œ
function CandidatesPage({ onNavigate, recruitFilter, pipelineFilter, onClearPipelineFilter, candidates: propCandidates, onUpdateCandidate, onBulkUpdateStatus, onShowAddModal }) {
  // propCandidatesãŒæ¸¡ã•ã‚Œã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  const CANDS = propCandidates || CANDIDATES;
  const [searchTerm, setSearchTerm] = useState("");
  const [stageFilter, setStageFilter] = useState("all");
  const [checkedSubstatuses, setCheckedSubstatuses] = useState(new Set()); // ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‚µãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆç©º = å…¨ã¦ï¼‰
  const [selectedIds, setSelectedIds] = useState(new Set());
  const [showBulkStatus, setShowBulkStatus] = useState(false);
  const [bulkToast, setBulkToast] = useState(null);

  // ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¸åã§ãƒ•ã‚£ãƒ«ã‚¿ã«ä½¿ãˆã‚‹ã‚¹ãƒ†ãƒ¼ã‚¸ä¸€è¦§
  const stages = ["all", "ã‚¨ãƒ³ãƒˆãƒªãƒ¼", "èª¬æ˜ä¼š", "ä¸€æ¬¡é¢æ¥", "äºŒæ¬¡é¢æ¥", "æœ€çµ‚é¢æ¥", "å†…å®š"];

  // æœ‰åŠ¹ãªã‚¹ãƒ†ãƒ¼ã‚¸ã‚’åˆ¤å®š
  const effectiveStageFilter = pipelineFilter ? pipelineFilter.stageName : stageFilter;

  // ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«å¯¾å¿œã™ã‚‹ã‚µãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¸€è¦§ï¼ˆä»¶æ•°ä»˜ãï¼‰
  const substatusOptions = useMemo(() => {
    const activeStage = pipelineFilter ? pipelineFilter.stageName : (stageFilter !== "all" ? stageFilter : null);
    if (!activeStage) return [];
    const dynPipeline = buildPipelineFromCandidates(CANDS);
    const pipelineEntry = dynPipeline.find(s => s.name === activeStage);
    if (!pipelineEntry) return [];
    return pipelineEntry.substages.map(s => {
      return { status: s.status, count: s.staying, isAlert: s.isAlert };
    });
  }, [effectiveStageFilter, recruitFilter]);

  // pipelineFilteråˆ°ç€æ™‚ã®ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ï¼ˆè©²å½“ã‚µãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã ã‘ONï¼‰
  const effectiveChecked = pipelineFilter
    ? new Set([pipelineFilter.substatus])
    : checkedSubstatuses;

  const filtered = CANDS.filter(c => {
    const matchRecruit = recruitFilter === "all" || c.recruitType === recruitFilter;
    const searchTarget = recruitFilter === "ä¸­é€”" || c.recruitType === "ä¸­é€”"
      ? `${c.lastName}${c.firstName}${c.company || ""}${c.position || ""}`
      : `${c.lastName}${c.firstName}${c.university || ""}`;
    const matchSearch = searchTarget.includes(searchTerm);
    // ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ•ã‚£ãƒ«ã‚¿
    let matchStage = true;
    if (effectiveStageFilter !== "all") {
      const mappedStage = PIPELINE_STAGE_MAP[effectiveStageFilter] || effectiveStageFilter;
      matchStage = c.stage === effectiveStageFilter || c.stage === mappedStage;
    }
    // ã‚µãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰ï¼šä½•ã‚‚ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã‘ã‚Œã°å…¨è¡¨ç¤º
    let matchSubstatus = true;
    if (effectiveChecked.size > 0) {
      matchSubstatus = effectiveChecked.has(c.substatus);
    }
    return matchRecruit && matchSearch && matchStage && matchSubstatus;
  });

  const toggleSubstatusCheck = (status) => {
    if (pipelineFilter) onClearPipelineFilter();
    setCheckedSubstatuses(prev => {
      const next = new Set(prev);
      next.has(status) ? next.delete(status) : next.add(status);
      return next;
    });
  };
  const clearSubstatusChecks = () => {
    if (pipelineFilter) onClearPipelineFilter();
    setCheckedSubstatuses(new Set());
  };

  const getStatusColor = (status) => {
    if (status === "é€šé" || status === "æ‰¿è«¾å¾…ã¡" || status === "åˆæ ¼" || status === "å‚åŠ æ¸ˆ") return { bg: "#dcfce7", text: "#15803d" };
    if (status === "äºˆå®š" || status === "æ–°è¦" || status === "æ¡ˆå†…æ¸ˆ" || status === "äºˆç´„æ¸ˆ" || status === "å†…å®šé€šçŸ¥") return { bg: "#dbeafe", text: "#1d4ed8" };
    if (status === "ä¸åˆæ ¼" || status === "æ¬ å¸­") return { bg: "#fee2e2", text: "#dc2626" };
    return { bg: "#f3f4f6", text: "#6b7280" };
  };

  const showBothTypes = recruitFilter === "all";
  const searchPlaceholder = recruitFilter === "ä¸­é€”" ? "åå‰ãƒ»ä¼æ¥­åãƒ»è·ç¨®ã§æ¤œç´¢..." : recruitFilter === "æ–°å’" ? "åå‰ãƒ»å¤§å­¦ã§æ¤œç´¢..." : "åå‰ãƒ»å¤§å­¦ãƒ»ä¼æ¥­åã§æ¤œç´¢...";

  const toggleSelect = (id) => {
    setSelectedIds(prev => {
      const next = new Set(prev);
      next.has(id) ? next.delete(id) : next.add(id);
      return next;
    });
  };
  const toggleSelectAll = () => {
    if (selectedIds.size === filtered.length) {
      setSelectedIds(new Set());
    } else {
      setSelectedIds(new Set(filtered.map(c => c.id)));
    }
  };
  const allSelected = filtered.length > 0 && selectedIds.size === filtered.length;

  const handleBulkAction = (action) => {
    const count = selectedIds.size;
    let msg = "";
    if (action === "email") msg = `${count}åã«ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼ˆãƒ‡ãƒ¢ï¼‰`;
    if (action === "line") msg = `${count}åã«LINEã‚’é€ä¿¡ã—ã¾ã—ãŸï¼ˆãƒ‡ãƒ¢ï¼‰`;
    if (action === "status") { setShowBulkStatus(true); return; }
    setBulkToast(msg);
    setTimeout(() => setBulkToast(null), 3000);
  };

  const handleBulkStatusChange = async (newStatus) => {
    const count = selectedIds.size;
    if (onBulkUpdateStatus) await onBulkUpdateStatus(selectedIds, newStatus);
    setBulkToast(`${count}åã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€Œ${newStatus}ã€ã«å¤‰æ›´ã—ã¾ã—ãŸ`);
    setShowBulkStatus(false);
    setSelectedIds(new Set());
    setTimeout(() => setBulkToast(null), 3000);
  };

  return (
    <div style={{ padding: 24, maxWidth: 1200 }}>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 20 }}>
        <h1 style={{ fontSize: 22, fontWeight: 700, color: "#111827" }}>å€™è£œè€…ç®¡ç†</h1>
        <button onClick={onShowAddModal} style={{ display: "flex", alignItems: "center", gap: 6, background: "#6366f1", color: "white", border: "none", borderRadius: 8, padding: "8px 16px", fontSize: 13, fontWeight: 500, cursor: "pointer" }}>
          <Icon name="plus" size={16} /> æ–°è¦ç™»éŒ²
        </button>
      </div>

      {/* æ¤œç´¢ + ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ•ã‚£ãƒ«ã‚¿ */}
      <div style={{ display: "flex", gap: 12, marginBottom: 10, alignItems: "center", flexWrap: "wrap" }}>
        <div style={{ position: "relative", flex: 1, maxWidth: 360 }}>
          <Icon name="search" size={16} style={{ position: "absolute", left: 10, top: 10 }} color="#9ca3af" />
          <input value={searchTerm} onChange={e => setSearchTerm(e.target.value)} placeholder={searchPlaceholder} style={{ width: "100%", padding: "8px 8px 8px 32px", border: "1px solid #d1d5db", borderRadius: 8, fontSize: 13, outline: "none", boxSizing: "border-box" }} />
        </div>
        <div style={{ display: "flex", gap: 4, background: "#f3f4f6", borderRadius: 8, padding: 3 }}>
          {stages.map(s => {
            const isActive = effectiveStageFilter === s || (s === "all" && effectiveStageFilter === "all");
            return (
              <button key={s} onClick={() => { if (pipelineFilter) onClearPipelineFilter(); setStageFilter(s); setCheckedSubstatuses(new Set()); }}
                style={{ padding: "6px 12px", border: "none", borderRadius: 6, fontSize: 11, cursor: "pointer", background: isActive ? "white" : "transparent", color: isActive ? "#4338ca" : "#6b7280", fontWeight: isActive ? 600 : 400, boxShadow: isActive ? "0 1px 2px rgba(0,0,0,0.1)" : "none" }}>
                {s === "all" ? "å…¨ã¦" : s}
              </button>
            );
          })}
        </div>
      </div>

      {/* ã‚µãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ */}
      {substatusOptions.length > 0 && (
        <div style={{ marginBottom: 14, padding: "12px 16px", background: "#f9fafb", borderRadius: 10, border: "1px solid #e5e7eb" }}>
          <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 8 }}>
            <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
              <Icon name="filter" size={13} color="#6366f1" />
              <span style={{ fontSize: 12, fontWeight: 600, color: "#374151" }}>
                {effectiveStageFilter} ã®ã‚µãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§çµã‚Šè¾¼ã¿
              </span>
              {effectiveChecked.size > 0 && (
                <span style={{ fontSize: 11, color: "#6366f1", background: "#eef2ff", padding: "2px 8px", borderRadius: 8, fontWeight: 600 }}>
                  {filtered.length}å è¡¨ç¤ºä¸­
                </span>
              )}
            </div>
            {effectiveChecked.size > 0 && (
              <button onClick={clearSubstatusChecks}
                style={{ background: "none", border: "none", color: "#6366f1", fontSize: 11, cursor: "pointer", fontWeight: 500, textDecoration: "underline" }}>
                ã™ã¹ã¦è§£é™¤
              </button>
            )}
          </div>
          <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
            {substatusOptions.map(opt => {
              const isChecked = effectiveChecked.has(opt.status);
              const alertStyle = opt.isAlert ? { borderColor: "#fecaca", background: isChecked ? "#fef2f2" : "white" } : {};
              return (
                <label key={opt.status}
                  style={{
                    display: "flex", alignItems: "center", gap: 6,
                    padding: "6px 12px", borderRadius: 8, cursor: "pointer",
                    border: isChecked ? "1.5px solid #818cf8" : "1px solid #d1d5db",
                    background: isChecked ? "#eef2ff" : "white",
                    transition: "all 0.15s",
                    ...alertStyle,
                    ...(isChecked && opt.isAlert ? { borderColor: "#f87171" } : {}),
                  }}
                  onMouseOver={e => { if (!isChecked) e.currentTarget.style.borderColor = "#a5b4fc"; }}
                  onMouseOut={e => { if (!isChecked) e.currentTarget.style.borderColor = "#d1d5db"; }}>
                  <input type="checkbox" checked={isChecked} onChange={() => toggleSubstatusCheck(opt.status)}
                    style={{ width: 15, height: 15, accentColor: opt.isAlert ? "#ef4444" : "#6366f1", cursor: "pointer" }} />
                  <span style={{ fontSize: 12, fontWeight: isChecked ? 600 : 400, color: opt.isAlert ? "#dc2626" : "#374151" }}>
                    {opt.status}
                  </span>
                  <span style={{ fontSize: 10, color: "#9ca3af", fontWeight: 500 }}>
                    ({opt.count})
                  </span>
                </label>
              );
            })}
          </div>
        </div>
      )}

      {/* ä¸€æ‹¬æ“ä½œãƒãƒ¼ */}
      {selectedIds.size > 0 && (
        <div style={{
          display: "flex", alignItems: "center", gap: 12, marginBottom: 12, padding: "10px 16px",
          background: "linear-gradient(90deg, #312e81, #4338ca)", borderRadius: 10,
          boxShadow: "0 4px 12px rgba(99,102,241,0.3)",
        }}>
          <span style={{ fontSize: 13, color: "white", fontWeight: 600 }}>
            {selectedIds.size}åé¸æŠä¸­
          </span>
          <div style={{ flex: 1 }} />
          <button onClick={() => handleBulkAction("email")}
            style={{ display: "flex", alignItems: "center", gap: 5, background: "rgba(255,255,255,0.15)", color: "white", border: "1px solid rgba(255,255,255,0.3)", borderRadius: 7, padding: "6px 14px", fontSize: 12, cursor: "pointer", fontWeight: 500 }}>
            <Icon name="mail" size={13} color="white" /> ãƒ¡ãƒ¼ãƒ«ä¸€æ‹¬é€ä¿¡
          </button>
          <button onClick={() => handleBulkAction("line")}
            style={{ display: "flex", alignItems: "center", gap: 5, background: "rgba(255,255,255,0.15)", color: "white", border: "1px solid rgba(255,255,255,0.3)", borderRadius: 7, padding: "6px 14px", fontSize: 12, cursor: "pointer", fontWeight: 500 }}>
            <Icon name="message-square" size={13} color="white" /> LINEä¸€æ‹¬é€ä¿¡
          </button>
          <div style={{ position: "relative" }}>
            <button onClick={() => handleBulkAction("status")}
              style={{ display: "flex", alignItems: "center", gap: 5, background: "rgba(255,255,255,0.15)", color: "white", border: "1px solid rgba(255,255,255,0.3)", borderRadius: 7, padding: "6px 14px", fontSize: 12, cursor: "pointer", fontWeight: 500 }}>
              <Icon name="check-square" size={13} color="white" /> ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¸€æ‹¬å¤‰æ›´
            </button>
            {showBulkStatus && (
              <div style={{ position: "absolute", right: 0, top: "110%", background: "white", borderRadius: 10, boxShadow: "0 8px 24px rgba(0,0,0,0.15)", padding: 6, zIndex: 100, minWidth: 160 }}>
                {["é€šé", "ä¸æ¡ç”¨", "ä¿ç•™", "è¾é€€", "å†…å®š"].map(s => (
                  <button key={s} onClick={() => handleBulkStatusChange(s)}
                    style={{ display: "block", width: "100%", textAlign: "left", padding: "8px 14px", border: "none", background: "none", fontSize: 13, cursor: "pointer", borderRadius: 6, color: s === "ä¸æ¡ç”¨" ? "#dc2626" : s === "è¾é€€" ? "#9ca3af" : "#111827" }}
                    onMouseOver={e => e.target.style.background = "#f3f4f6"} onMouseOut={e => e.target.style.background = "none"}>
                    {s}
                  </button>
                ))}
                <div style={{ borderTop: "1px solid #e5e7eb", margin: "4px 0" }} />
                <button onClick={() => setShowBulkStatus(false)}
                  style={{ display: "block", width: "100%", textAlign: "center", padding: "6px 14px", border: "none", background: "none", fontSize: 11, cursor: "pointer", color: "#9ca3af" }}>
                  ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
              </div>
            )}
          </div>
          <button onClick={() => setSelectedIds(new Set())}
            style={{ background: "none", color: "rgba(255,255,255,0.7)", border: "none", fontSize: 18, cursor: "pointer", padding: "0 4px", lineHeight: 1 }}>
            Ã—
          </button>
        </div>
      )}

      <div style={{ background: "white", borderRadius: 12, boxShadow: "0 1px 3px rgba(0,0,0,0.08)", overflow: "auto" }}>
        <table style={{ width: "100%", borderCollapse: "collapse", minWidth: 1100 }}>
          <thead>
            <tr style={{ background: "#f9fafb" }}>
              <th style={{ padding: "12px 8px 12px 16px", width: 36, borderBottom: "1px solid #e5e7eb" }}>
                <input type="checkbox" checked={allSelected} onChange={toggleSelectAll}
                  style={{ width: 16, height: 16, cursor: "pointer", accentColor: "#6366f1" }} />
              </th>
              {[
                "æ°å",
                showBothTypes ? "åŒºåˆ†" : null,
                recruitFilter === "ä¸­é€”" ? "ç¾è·ä¼æ¥­ãƒ»è·ç¨®" : recruitFilter === "æ–°å’" ? "å¤§å­¦ãƒ»å­¦éƒ¨" : "æ‰€å±",
                recruitFilter === "ä¸­é€”" ? "çµŒé¨“å¹´æ•°" : recruitFilter === "æ–°å’" ? "å’å¹´" : "å’å¹´/çµŒé¨“",
                "ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ—¥",
                "é¸è€ƒã‚¹ãƒ†ãƒ¼ã‚¸", "å½¢æ…‹", "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", "å¿—æœ›åº¦", "è©•ä¾¡", "ç™»éŒ²æ—¥", ""
              ].filter(Boolean).map((h, i) => (
                <th key={i} style={{ padding: "12px 12px", fontSize: 11, fontWeight: 600, color: "#6b7280", textAlign: "left", borderBottom: "1px solid #e5e7eb", whiteSpace: "nowrap" }}>{h}</th>
              ))}
            </tr>
          </thead>
          <tbody>
            {filtered.map(c => {
              const sc = getStatusColor(c.status);
              const isNewGrad = c.recruitType === "æ–°å’";
              const isSelected = selectedIds.has(c.id);
              return (
                <tr key={c.id} style={{ cursor: "pointer", borderBottom: "1px solid #f3f4f6", background: isSelected ? "#eef2ff" : "white" }}
                  onMouseOver={e => { if (!isSelected) e.currentTarget.style.background = "#f9fafb"; }} onMouseOut={e => { if (!isSelected) e.currentTarget.style.background = "white"; }}>
                  <td style={{ padding: "12px 8px 12px 16px" }} onClick={e => e.stopPropagation()}>
                    <input type="checkbox" checked={isSelected} onChange={() => toggleSelect(c.id)}
                      style={{ width: 16, height: 16, cursor: "pointer", accentColor: "#6366f1" }} />
                  </td>
                  <td style={{ padding: "12px 16px" }} onClick={() => onNavigate("candidate-detail", c.id)}>
                    <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
                      <div style={{ width: 34, height: 34, borderRadius: "50%", background: isNewGrad ? "#eef2ff" : "#fffbeb", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 12, fontWeight: 600, color: isNewGrad ? "#4338ca" : "#92400e" }}>{c.lastName[0]}</div>
                      <div>
                        <div style={{ fontSize: 13, fontWeight: 600, color: "#111827" }}>{c.lastName} {c.firstName}</div>
                        {(c.lastNameKana || c.firstNameKana) && <div style={{ fontSize: 10, color: "#b0b5bf", marginTop: 1 }}>{c.lastNameKana || ""} {c.firstNameKana || ""}</div>}
                        <div style={{ fontSize: 11, color: "#9ca3af" }}>{c.route}{c.agent ? ` / ${c.agent}` : ""}</div>
                      </div>
                    </div>
                  </td>
                  {showBothTypes && <td style={{ padding: "12px 10px", whiteSpace: "nowrap" }}><RecruitTypeBadge type={c.recruitType} /></td>}
                  <td style={{ padding: "12px 10px", fontSize: 13, color: "#374151" }} onClick={() => onNavigate("candidate-detail", c.id)}>
                    {isNewGrad
                      ? <>{c.university}<br /><span style={{ fontSize: 11, color: "#9ca3af" }}>{c.faculty}{c.department ? ` / ${c.department}` : ""}</span></>
                      : <>{c.company}<br /><span style={{ fontSize: 11, color: "#9ca3af" }}>{c.position}</span></>
                    }
                  </td>
                  <td style={{ padding: "12px 10px", fontSize: 13, color: "#374151", whiteSpace: "nowrap" }}>
                    {isNewGrad ? c.gradYear : c.experience ? `${c.experience}å¹´` : "â€”"}
                  </td>
                  <td style={{ padding: "12px 10px", fontSize: 12, color: "#6b7280", whiteSpace: "nowrap" }}>{c.entryDate || "â€”"}</td>
                  <td style={{ padding: "12px 10px", whiteSpace: "nowrap" }}><span style={{ fontSize: 11, fontWeight: 500, padding: "3px 8px", borderRadius: 12, background: "#eef2ff", color: "#4338ca", whiteSpace: "nowrap" }}>{c.stage}</span></td>
                  <td style={{ padding: "12px 10px", whiteSpace: "nowrap" }}><FormatBadge format={c.format} /></td>
                  <td style={{ padding: "12px 10px", whiteSpace: "nowrap" }}><span style={{ fontSize: 11, fontWeight: 500, padding: "3px 8px", borderRadius: 12, background: sc.bg, color: sc.text, whiteSpace: "nowrap" }}>{c.status}</span></td>
                  <td style={{ padding: "12px 10px", whiteSpace: "nowrap" }}>{[...Array(5)].map((_, i) => <span key={i} style={{ color: i < c.aspiration ? "#f59e0b" : "#e5e7eb", fontSize: 12 }}>â˜…</span>)}</td>
                  <td style={{ padding: "12px 10px", fontSize: 13, fontWeight: 600, whiteSpace: "nowrap", color: c.score ? (c.score >= 4 ? "#10b981" : c.score >= 3 ? "#f59e0b" : "#ef4444") : "#d1d5db" }}>{c.score ? `${c.score}/5.0` : "â€”"}</td>
                  <td style={{ padding: "12px 10px", fontSize: 12, color: "#9ca3af", whiteSpace: "nowrap" }}>{c.createdAt}</td>
                  <td style={{ padding: "12px 8px" }} onClick={() => onNavigate("candidate-detail", c.id)}><Icon name="chevron-right" size={16} color="#d1d5db" /></td>
                </tr>
              );
            })}
          </tbody>
        </table>
        {filtered.length === 0 && (
          <div style={{ padding: 40, textAlign: "center", color: "#9ca3af", fontSize: 13 }}>è©²å½“ã™ã‚‹å€™è£œè€…ãŒã„ã¾ã›ã‚“</div>
        )}
      </div>

      {/* ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ */}
      {bulkToast && (
        <div style={{
          position: "fixed", bottom: 24, left: "50%", transform: "translateX(-50%)",
          background: "#10b981", color: "white", padding: "12px 24px", borderRadius: 10,
          fontSize: 13, fontWeight: 600, boxShadow: "0 4px 16px rgba(16,185,129,0.3)", zIndex: 999,
          display: "flex", alignItems: "center", gap: 8,
        }}>
          <Icon name="check-circle" size={16} color="white" /> {bulkToast}
        </div>
      )}
    </div>
  );
}

// Candidate Detail - æ–°å’/ä¸­é€”å¯¾å¿œ
function CandidateDetailPage({ candidateId, onNavigate, candidates: propCandidates, onUpdateCandidate }) {
  const CANDS = propCandidates || CANDIDATES;
  const c = CANDS.find(c => c.id === candidateId) || CANDS[0];
  const isNewGrad = c.recruitType === "æ–°å’";
  const [activeTab, setActiveTab] = useState("timeline");
  const [memoText, setMemoText] = useState(c.notes || "");

  // ãƒ¡ãƒ¼ãƒ«é€ä¿¡é–¢é€£
  const [showCompose, setShowCompose] = useState(false);
  const [emailSubject, setEmailSubject] = useState("");
  const [emailBody, setEmailBody] = useState("");
  const [sending, setSending] = useState(false);
  const [sendError, setSendError] = useState("");
  const [sendSuccess, setSendSuccess] = useState("");
  const [messageHistory, setMessageHistory] = useState([]);
  const [loadingMessages, setLoadingMessages] = useState(false);

  // Gmail APIã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã‚’èª­ã¿è¾¼ã‚€
  const loadMessages = useCallback(async () => {
    if (!c.email) return;
    setLoadingMessages(true);
    try {
      const res = await fetch('/.netlify/functions/gmail', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'fetch', candidateEmail: c.email }),
      });
      const data = await res.json();
      if (data.success && data.messages) {
        setMessageHistory(data.messages);
      }
    } catch (err) {
      console.error('ãƒ¡ãƒ¼ãƒ«å–å¾—ã‚¨ãƒ©ãƒ¼:', err);
    }
    setLoadingMessages(false);
  }, [c.email]);

  useEffect(() => { if (activeTab === "messages") loadMessages(); }, [activeTab, loadMessages]);

  // Gmail APIçµŒç”±ã§ãƒ¡ãƒ¼ãƒ«é€ä¿¡
  const handleSendEmail = async () => {
    if (!emailSubject.trim() || !emailBody.trim()) {
      setSendError("ä»¶åã¨æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return;
    }
    if (!c.email) {
      setSendError("ã“ã®å€™è£œè€…ã«ã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“");
      return;
    }
    setSending(true);
    setSendError("");
    setSendSuccess("");

    try {
      const res = await fetch('/.netlify/functions/gmail', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action: 'send',
          to: c.email,
          subject: emailSubject,
          body: emailBody,
          candidateName: c.lastName + " " + c.firstName,
        }),
      });
      const result = await res.json();

      if (!res.ok || !result.success) {
        setSendError(result.error || "é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ");
        setSending(false);
        return;
      }

      // Supabaseã«ã‚‚å±¥æ­´ã‚’ä¿å­˜
      await sbApi.insert('messages', {
        candidate_id: c.id,
        direction: 'outbound',
        channel: 'email',
        to_email: c.email,
        subject: emailSubject,
        body: emailBody,
        status: 'sent',
      });

      setSendSuccess("ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼");
      setEmailSubject("");
      setEmailBody("");
      setShowCompose(false);
      loadMessages();
      setTimeout(() => setSendSuccess(""), 3000);
    } catch (err) {
      setSendError("é€ä¿¡ã‚¨ãƒ©ãƒ¼: " + err.message);
    }
    setSending(false);
  };

  // å®Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’æ§‹ç¯‰
  const buildTimeline = () => {
    const STAGE_ORDER = ["ã‚¨ãƒ³ãƒˆãƒªãƒ¼/å—ä»˜æ¸ˆ", "èª¬æ˜ä¼š/å‚åŠ æ¸ˆ", "èª¬æ˜ä¼š/äºˆç´„æ¸ˆ", "èª¬æ˜ä¼š/æ¬ å¸­", "1æ¬¡é¢æ¥", "2æ¬¡é¢æ¥", "æœ€çµ‚é¢æ¥", "å†…å®šæ‰¿è«¾/æ‰¿è«¾æ¸ˆ"];
    const currentStage = c.stage || "";
    const currentIdx = STAGE_ORDER.findIndex(s => currentStage.startsWith(s.split("/")[0]));
    const steps = [];

    // ã‚¨ãƒ³ãƒˆãƒªãƒ¼
    steps.push({
      stage: "ã‚¨ãƒ³ãƒˆãƒªãƒ¼",
      date: c.entryDate || "â€”",
      status: currentIdx >= 0 ? "completed" : "current",
      result: currentIdx >= 0 ? "å®Œäº†" : null,
    });

    // èª¬æ˜ä¼š
    if (currentIdx >= 1 || currentStage.includes("èª¬æ˜ä¼š")) {
      const briefingDone = currentIdx > 3 || (currentIdx >= 1 && currentIdx <= 3);
      steps.push({
        stage: "èª¬æ˜ä¼š",
        date: c.stageDate && currentStage.includes("èª¬æ˜ä¼š") ? c.stageDate : c.stageDate || "â€”",
        status: briefingDone && currentIdx > 3 ? "completed" : currentStage.includes("èª¬æ˜ä¼š") ? "current" : "pending",
        result: currentStage.includes("å‚åŠ ") ? "å‚åŠ " : currentStage.includes("æ¬ å¸­") ? "æ¬ å¸­" : currentStage.includes("äºˆç´„") ? "äºˆç´„æ¸ˆ" : briefingDone ? "å®Œäº†" : null,
      });
    } else {
      steps.push({ stage: "èª¬æ˜ä¼š", date: "â€”", status: "pending" });
    }

    // 1æ¬¡é¢æ¥
    if (currentIdx >= 4) {
      steps.push({ stage: "1æ¬¡é¢æ¥ï¼ˆäººäº‹é¢è«‡ï¼‰", date: c.stageDate && currentStage === "1æ¬¡é¢æ¥" ? c.stageDate : "â€”", status: currentIdx > 4 ? "completed" : "current", result: currentIdx > 4 ? "é€šé" : null });
    } else if (currentStage === "1æ¬¡é¢æ¥") {
      steps.push({ stage: "1æ¬¡é¢æ¥ï¼ˆäººäº‹é¢è«‡ï¼‰", date: c.stageDate || "â€”", status: "current" });
    } else {
      steps.push({ stage: "1æ¬¡é¢æ¥ï¼ˆäººäº‹é¢è«‡ï¼‰", date: "æœªå®š", status: "pending" });
    }

    // 2æ¬¡é¢æ¥
    if (currentIdx >= 5) {
      steps.push({ stage: "2æ¬¡é¢æ¥", date: c.stageDate && currentStage === "2æ¬¡é¢æ¥" ? c.stageDate : "â€”", status: currentIdx > 5 ? "completed" : "current", result: currentIdx > 5 ? "é€šé" : null });
    } else if (currentStage === "2æ¬¡é¢æ¥") {
      steps.push({ stage: "2æ¬¡é¢æ¥", date: c.stageDate || "â€”", status: "current" });
    } else {
      steps.push({ stage: "2æ¬¡é¢æ¥", date: "æœªå®š", status: "pending" });
    }

    // æœ€çµ‚é¢æ¥
    if (currentIdx >= 6) {
      steps.push({ stage: "æœ€çµ‚é¢æ¥", date: "â€”", status: currentIdx > 6 ? "completed" : "current", result: currentIdx > 6 ? "é€šé" : null });
    } else if (currentStage === "æœ€çµ‚é¢æ¥") {
      steps.push({ stage: "æœ€çµ‚é¢æ¥", date: c.stageDate || "â€”", status: "current" });
    } else {
      steps.push({ stage: "æœ€çµ‚é¢æ¥", date: "æœªå®š", status: "pending" });
    }

    // å†…å®š
    if (currentStage.includes("å†…å®š")) {
      steps.push({ stage: "å†…å®šæ‰¿è«¾", date: c.stageDate || "â€”", status: "current", result: "æ‰¿è«¾æ¸ˆ" });
    } else {
      steps.push({ stage: "å†…å®š", date: "æœªå®š", status: "pending" });
    }

    return steps;
  };
  const timeline = buildTimeline();
  return (
    <div style={{ padding: 24, maxWidth: 1000 }}>
      <button onClick={() => onNavigate("candidates")} style={{ display: "flex", alignItems: "center", gap: 4, color: "#6366f1", background: "none", border: "none", cursor: "pointer", fontSize: 13, marginBottom: 16 }}>
        <Icon name="arrow-left" size={16} /> å€™è£œè€…ä¸€è¦§ã«æˆ»ã‚‹
      </button>
      <div style={{ background: "white", borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.08)", marginBottom: 16 }}>
        <div style={{ display: "flex", gap: 20, alignItems: "flex-start" }}>
          <div style={{ width: 72, height: 72, borderRadius: 16, background: isNewGrad ? "#eef2ff" : "#fffbeb", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 26, fontWeight: 700, color: isNewGrad ? "#4338ca" : "#92400e", flexShrink: 0 }}>{c.lastName[0]}</div>
          <div style={{ flex: 1 }}>
            <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
              <h2 style={{ fontSize: 22, fontWeight: 700, color: "#111827", margin: 0 }}>{c.lastName} {c.firstName}</h2>
              {(c.lastNameKana || c.firstNameKana) && <span style={{ fontSize: 13, color: "#9ca3af" }}>({c.lastNameKana || ""} {c.firstNameKana || ""})</span>}
              <RecruitTypeBadge type={c.recruitType} />
            </div>
            <div style={{ display: "flex", flexWrap: "wrap", gap: 16, marginTop: 8, fontSize: 13, color: "#6b7280" }}>
              <span style={{ display: "flex", alignItems: "center", gap: 4 }}><Icon name="mail" size={14} /> {c.email}</span>
              <span style={{ display: "flex", alignItems: "center", gap: 4 }}><Icon name="phone" size={14} /> {c.phone}</span>
              {c.birthDate && <span style={{ display: "flex", alignItems: "center", gap: 4 }}><Icon name="calendar" size={14} /> ç”Ÿå¹´æœˆæ—¥: {c.birthDate}</span>}
            </div>
            <div style={{ display: "flex", flexWrap: "wrap", gap: 16, marginTop: 6, fontSize: 13, color: "#6b7280" }}>
              {isNewGrad ? (
                <span style={{ display: "flex", alignItems: "center", gap: 4 }}>
                  <Icon name="graduation-cap" size={14} /> {c.university} {c.faculty}{c.department ? ` / ${c.department}` : ""} / {c.gradYear}å¹´å’{c.graduationPeriod ? ` (${c.graduationPeriod})` : ""} / {c.majorType}
                </span>
              ) : (
                <span style={{ display: "flex", alignItems: "center", gap: 4 }}>
                  <Icon name="briefcase" size={14} /> {c.company} / {c.position} / çµŒé¨“{c.experience}å¹´
                </span>
              )}
            </div>
            <div style={{ display: "flex", gap: 12, marginTop: 10, flexWrap: "wrap" }}>
              <span style={{ fontSize: 12, padding: "3px 10px", borderRadius: 12, background: "#eef2ff", color: "#4338ca" }}>çµŒè·¯: {c.route}</span>
              {c.entryDate && <span style={{ fontSize: 12, padding: "3px 10px", borderRadius: 12, background: "#e0e7ff", color: "#3730a3" }}>ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ—¥: {c.entryDate}</span>}
              {c.stageDate && <span style={{ fontSize: 12, padding: "3px 10px", borderRadius: 12, background: "#dbeafe", color: "#1e40af" }}>ã‚¹ãƒ†ãƒ¼ã‚¸åˆ°é”æ—¥: {c.stageDate}</span>}
              {c.originalStage && <span style={{ fontSize: 12, padding: "3px 10px", borderRadius: 12, background: "#f0f9ff", color: "#075985" }}>å…ƒã‚¹ãƒ†ãƒ¼ã‚¸: {c.originalStage}</span>}
              <span style={{ fontSize: 12, padding: "3px 10px", borderRadius: 12, background: "#fef3c7", color: "#92400e" }}>å¿—æœ›åº¦: {"â˜…".repeat(c.aspiration)}{"â˜†".repeat(5 - c.aspiration)}</span>
              {c.agent && <span style={{ fontSize: 12, padding: "3px 10px", borderRadius: 12, background: "#f0fdf4", color: "#15803d" }}>{c.agent}</span>}
            </div>
            {c.notes && (
              <div style={{ marginTop: 10, padding: "8px 12px", background: "#fffbeb", borderRadius: 8, fontSize: 12, color: "#92400e", border: "1px solid #fde68a" }}>
                ğŸ“ ãƒ¡ãƒ¢: {c.notes}
              </div>
            )}
          </div>
          <div style={{ display: "flex", gap: 8 }}>
            <button style={{ padding: "8px 16px", border: "1px solid #d1d5db", borderRadius: 8, background: "white", fontSize: 12, cursor: "pointer", color: "#374151" }}>LINEé€ä¿¡</button>
            <button onClick={() => onNavigate("interview-fb")} style={{ padding: "8px 16px", border: "none", borderRadius: 8, background: "#6366f1", color: "white", fontSize: 12, cursor: "pointer" }}>FBå…¥åŠ›</button>
          </div>
        </div>
      </div>
      <div style={{ display: "flex", gap: 4, marginBottom: 16, background: "#f3f4f6", borderRadius: 10, padding: 4 }}>
        {["timeline", "evaluation", "messages", "memo", "docs"].map(tab => (
          <button key={tab} onClick={() => setActiveTab(tab)}
            style={{ flex: 1, padding: "8px 0", border: "none", borderRadius: 8, fontSize: 12, fontWeight: activeTab === tab ? 600 : 400, background: activeTab === tab ? "white" : "transparent", color: activeTab === tab ? "#4338ca" : "#6b7280", cursor: "pointer", boxShadow: activeTab === tab ? "0 1px 2px rgba(0,0,0,0.1)" : "none" }}>
            {({ timeline: "é¸è€ƒçŠ¶æ³", evaluation: "è©•ä¾¡ãƒ»FB", messages: "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸", memo: "ãƒ¡ãƒ¢", docs: "æ›¸é¡" })[tab]}
          </button>
        ))}
      </div>
      {/* ===== é¸è€ƒçŠ¶æ³ã‚¿ãƒ– ===== */}
      {activeTab === "timeline" && (
        <>
          <div style={{ background: "white", borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
            <h3 style={{ fontSize: 15, fontWeight: 600, color: "#111827", marginBottom: 20 }}>é¸è€ƒã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h3>
            {timeline.map((t, i) => (
              <div key={i} style={{ display: "flex", gap: 16 }}>
                <div style={{ display: "flex", flexDirection: "column", alignItems: "center", width: 20 }}>
                  <div style={{ width: 12, height: 12, borderRadius: "50%", background: t.status === "completed" ? "#10b981" : t.status === "current" ? "#6366f1" : "#d1d5db", border: t.status === "current" ? "3px solid #c7d2fe" : "none", boxSizing: "content-box", flexShrink: 0 }} />
                  {i < timeline.length - 1 && <div style={{ width: 2, flex: 1, background: t.status === "completed" ? "#a7f3d0" : "#e5e7eb", minHeight: 40 }} />}
                </div>
                <div style={{ flex: 1, paddingBottom: 20 }}>
                  <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start" }}>
                    <div style={{ fontSize: 14, fontWeight: 600, color: t.status === "pending" ? "#9ca3af" : "#111827" }}>{t.stage}</div>
                    <div style={{ fontSize: 12, color: "#9ca3af" }}>{t.date}</div>
                  </div>
                  {t.result && <span style={{ fontSize: 11, padding: "2px 8px", borderRadius: 10, background: t.result === "é€šé" || t.result === "å®Œäº†" || t.result === "å‚åŠ " || t.result === "æ‰¿è«¾æ¸ˆ" ? "#dcfce7" : t.result === "æ¬ å¸­" ? "#fee2e2" : "#fef3c7", color: t.result === "é€šé" || t.result === "å®Œäº†" || t.result === "å‚åŠ " || t.result === "æ‰¿è«¾æ¸ˆ" ? "#15803d" : t.result === "æ¬ å¸­" ? "#dc2626" : "#92400e", marginTop: 4, display: "inline-block" }}>{t.result}</span>}
                </div>
              </div>
            ))}
          </div>
          <div style={{ background: "white", borderRadius: 12, padding: 20, marginTop: 16, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
            <h4 style={{ fontSize: 14, fontWeight: 600, color: "#111827", marginBottom: 12 }}>åŸºæœ¬æƒ…å ±</h4>
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "10px 24px", fontSize: 13 }}>
              <div><span style={{ color: "#9ca3af" }}>ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸:</span> <strong style={{ color: "#4338ca" }}>{c.stage}</strong></div>
              {c.originalStage && <div><span style={{ color: "#9ca3af" }}>è©³ç´°ã‚¹ãƒ†ãƒ¼ã‚¸:</span> <strong>{c.originalStage}</strong></div>}
              {c.entryDate && <div><span style={{ color: "#9ca3af" }}>ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ—¥:</span> <strong>{c.entryDate}</strong></div>}
              {c.stageDate && <div><span style={{ color: "#9ca3af" }}>ã‚¹ãƒ†ãƒ¼ã‚¸åˆ°é”æ—¥:</span> <strong>{c.stageDate}</strong></div>}
              {c.birthDate && <div><span style={{ color: "#9ca3af" }}>ç”Ÿå¹´æœˆæ—¥:</span> <strong>{c.birthDate}</strong></div>}
              {c.graduationPeriod && <div><span style={{ color: "#9ca3af" }}>å’æ¥­äºˆå®š:</span> <strong>{c.graduationPeriod}</strong></div>}
              <div><span style={{ color: "#9ca3af" }}>ç™»éŒ²æ—¥:</span> <strong>{c.createdAt}</strong></div>
              <div><span style={{ color: "#9ca3af" }}>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</span> <strong>{c.status}</strong></div>
            </div>
          </div>
        </>
      )}

      {/* ===== è©•ä¾¡ãƒ»FBã‚¿ãƒ– ===== */}
      {activeTab === "evaluation" && (
        <div style={{ background: "white", borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
          <h3 style={{ fontSize: 15, fontWeight: 600, color: "#111827", marginBottom: 20 }}>è©•ä¾¡ãƒ»ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</h3>
          <div style={{ display: "flex", alignItems: "center", gap: 16, marginBottom: 20, padding: 16, background: "#f9fafb", borderRadius: 10 }}>
            <div style={{ textAlign: "center" }}>
              <div style={{ fontSize: 32, fontWeight: 700, color: c.score >= 4 ? "#10b981" : c.score >= 3 ? "#f59e0b" : "#ef4444" }}>{c.score ? c.score.toFixed(1) : "â€”"}</div>
              <div style={{ fontSize: 11, color: "#9ca3af" }}>ç·åˆè©•ä¾¡</div>
            </div>
            <div style={{ flex: 1 }}>
              <div style={{ fontSize: 13, color: "#6b7280", marginBottom: 4 }}>å¿—æœ›åº¦: {[...Array(5)].map((_, i) => <span key={i} style={{ color: i < c.aspiration ? "#f59e0b" : "#e5e7eb" }}>â˜…</span>)}</div>
              <div style={{ fontSize: 13, color: "#6b7280" }}>é¸è€ƒå½¢æ…‹: {c.format || "â€”"}</div>
            </div>
          </div>
          <div style={{ padding: 20, background: "#f9fafb", borderRadius: 10, textAlign: "center", color: "#9ca3af", fontSize: 13 }}>
            <Icon name="file-text" size={24} color="#d1d5db" />
            <div style={{ marginTop: 8 }}>é¢æ¥ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>
            <button onClick={() => onNavigate("interview-fb")} style={{ marginTop: 12, padding: "8px 20px", border: "none", borderRadius: 8, background: "#6366f1", color: "white", fontSize: 12, cursor: "pointer" }}>FBå…¥åŠ›</button>
          </div>
        </div>
      )}

      {/* ===== ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ãƒ– ===== */}
      {activeTab === "messages" && (
        <div style={{ background: "white", borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 20 }}>
            <h3 style={{ fontSize: 15, fontWeight: 600, color: "#111827" }}>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
            <div style={{ display: "flex", gap: 8 }}>
              <button onClick={() => { setShowCompose(!showCompose); setSendError(""); setSendSuccess(""); }}
                style={{ padding: "8px 20px", border: "none", borderRadius: 8, background: showCompose ? "#ef4444" : "#1d4aff", color: "white", fontSize: 12, cursor: "pointer", fontWeight: 500 }}>
                {showCompose ? "âœ• é–‰ã˜ã‚‹" : "âœ‰ ãƒ¡ãƒ¼ãƒ«ä½œæˆ"}
              </button>
            </div>
          </div>

          {/* é€ä¿¡æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */}
          {sendSuccess && (
            <div style={{ padding: 12, background: "#ecfdf5", border: "1px solid #a7f3d0", borderRadius: 8, color: "#065f46", fontSize: 13, marginBottom: 16 }}>
              âœ“ {sendSuccess}
            </div>
          )}

          {/* ãƒ¡ãƒ¼ãƒ«ä½œæˆãƒ•ã‚©ãƒ¼ãƒ  */}
          {showCompose && (
            <div style={{ border: "1px solid #e5e7eb", borderRadius: 10, padding: 20, marginBottom: 20, background: "#fafbfc" }}>
              <div style={{ marginBottom: 14 }}>
                <label style={{ display: "block", fontSize: 12, fontWeight: 500, color: "#6b7280", marginBottom: 4 }}>å®›å…ˆ</label>
                <div style={{ padding: "8px 12px", background: "#f3f4f6", borderRadius: 6, fontSize: 13, color: "#374151" }}>
                  {c.lastName} {c.firstName} &lt;{c.email || "ãƒ¡ãƒ¼ãƒ«æœªç™»éŒ²"}&gt;
                </div>
              </div>
              <div style={{ marginBottom: 14 }}>
                <label style={{ display: "block", fontSize: 12, fontWeight: 500, color: "#6b7280", marginBottom: 4 }}>ä»¶å</label>
                <input
                  type="text"
                  value={emailSubject}
                  onChange={e => setEmailSubject(e.target.value)}
                  placeholder="ä»¶åã‚’å…¥åŠ›..."
                  style={{ width: "100%", padding: "8px 12px", border: "1px solid #d1d5db", borderRadius: 6, fontSize: 13, outline: "none", boxSizing: "border-box" }}
                />
              </div>
              <div style={{ marginBottom: 14 }}>
                <label style={{ display: "block", fontSize: 12, fontWeight: 500, color: "#6b7280", marginBottom: 4 }}>æœ¬æ–‡</label>
                <textarea
                  value={emailBody}
                  onChange={e => setEmailBody(e.target.value)}
                  placeholder="ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã‚’å…¥åŠ›..."
                  rows={8}
                  style={{ width: "100%", padding: 12, border: "1px solid #d1d5db", borderRadius: 6, fontSize: 13, lineHeight: 1.7, resize: "vertical", outline: "none", fontFamily: "inherit", boxSizing: "border-box" }}
                />
              </div>
              {sendError && (
                <div style={{ padding: 10, background: "#fef2f2", border: "1px solid #fecaca", borderRadius: 6, color: "#dc2626", fontSize: 12, marginBottom: 12 }}>
                  {sendError}
                </div>
              )}
              <div style={{ display: "flex", justifyContent: "flex-end", gap: 8 }}>
                <button onClick={() => setShowCompose(false)}
                  style={{ padding: "8px 20px", border: "1px solid #d1d5db", borderRadius: 8, background: "white", fontSize: 12, cursor: "pointer", color: "#6b7280" }}>
                  ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button onClick={handleSendEmail} disabled={sending}
                  style={{ padding: "8px 24px", border: "none", borderRadius: 8, background: sending ? "#93c5fd" : "#1d4aff", color: "white", fontSize: 12, cursor: sending ? "default" : "pointer", fontWeight: 500 }}>
                  {sending ? "é€ä¿¡ä¸­..." : "é€ä¿¡ã™ã‚‹"}
                </button>
              </div>
            </div>
          )}

          {/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ (Gmail API) */}
          <div>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 12 }}>
              <h4 style={{ fontSize: 13, fontWeight: 600, color: "#6b7280" }}>ãƒ¡ãƒ¼ãƒ«å±¥æ­´</h4>
              <button onClick={loadMessages} disabled={loadingMessages}
                style={{ padding: "4px 12px", border: "1px solid #d1d5db", borderRadius: 6, background: "white", fontSize: 11, cursor: "pointer", color: "#6b7280" }}>
                {loadingMessages ? "èª­è¾¼ä¸­..." : "â†» æ›´æ–°"}
              </button>
            </div>
            {loadingMessages && messageHistory.length === 0 ? (
              <div style={{ textAlign: "center", padding: 20, color: "#9ca3af", fontSize: 13 }}>èª­ã¿è¾¼ã¿ä¸­...</div>
            ) : messageHistory.length === 0 ? (
              <div style={{ padding: 24, background: "#f9fafb", borderRadius: 10, textAlign: "center", color: "#9ca3af", fontSize: 13 }}>
                <Icon name="mail" size={24} color="#d1d5db" />
                <div style={{ marginTop: 8 }}>ã“ã®å€™è£œè€…ã¨ã®ãƒ¡ãƒ¼ãƒ«å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>
                <div style={{ marginTop: 4, fontSize: 12 }}>ã€Œãƒ¡ãƒ¼ãƒ«ä½œæˆã€ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã§ãã¾ã™</div>
              </div>
            ) : (
              <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
                {messageHistory.map((msg, i) => {
                  const isInbound = msg.direction === "inbound";
                  return (
                    <div key={msg.id || i} style={{
                      border: "1px solid " + (isInbound ? "#bfdbfe" : "#e5e7eb"),
                      borderRadius: 8, padding: 14,
                      background: isInbound ? "#eff6ff" : "#fff",
                      borderLeft: "3px solid " + (isInbound ? "#3b82f6" : "#1d4aff"),
                    }}>
                      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6 }}>
                        <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                          <span style={{
                            background: isInbound ? "#dbeafe" : "#e0e7ff",
                            color: isInbound ? "#1d4aff" : "#4338ca",
                            padding: "2px 8px", borderRadius: 4, fontSize: 11, fontWeight: 500,
                          }}>
                            {isInbound ? "â† å—ä¿¡" : "â†’ é€ä¿¡"}
                          </span>
                          <span style={{ fontSize: 12, color: "#6b7280" }}>
                            {isInbound ? msg.from : msg.to}
                          </span>
                        </div>
                        <span style={{ fontSize: 11, color: "#9ca3af" }}>
                          {msg.date ? new Date(msg.date).toLocaleString('ja-JP', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' }) : ""}
                        </span>
                      </div>
                      <div style={{ fontSize: 13, fontWeight: 500, color: "#111827", marginBottom: 4 }}>{msg.subject}</div>
                      <div style={{ fontSize: 12, color: "#6b7280", lineHeight: 1.6, whiteSpace: "pre-wrap", maxHeight: 80, overflow: "hidden" }}>{msg.body}</div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        </div>
      )}

      {/* ===== ãƒ¡ãƒ¢ã‚¿ãƒ– ===== */}
      {activeTab === "memo" && (
        <div style={{ background: "white", borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
          <h3 style={{ fontSize: 15, fontWeight: 600, color: "#111827", marginBottom: 20 }}>ãƒ¡ãƒ¢</h3>
          <textarea
            value={memoText}
            onChange={e => setMemoText(e.target.value)}
            placeholder="ã“ã®å€™è£œè€…ã«é–¢ã™ã‚‹ãƒ¡ãƒ¢ã‚’å…¥åŠ›..."
            style={{ width: "100%", minHeight: 160, padding: 14, border: "1px solid #e5e7eb", borderRadius: 10, fontSize: 13, lineHeight: 1.7, resize: "vertical", outline: "none", fontFamily: "inherit", boxSizing: "border-box" }}
          />
          <div style={{ display: "flex", justifyContent: "flex-end", marginTop: 10 }}>
            <button onClick={() => { if (onUpdateCandidate) onUpdateCandidate(c.id, { notes: memoText }); }}
              style={{ padding: "8px 20px", border: "none", borderRadius: 8, background: "#6366f1", color: "white", fontSize: 12, cursor: "pointer" }}>ä¿å­˜</button>
          </div>
        </div>
      )}

      {/* ===== æ›¸é¡ã‚¿ãƒ– ===== */}
      {activeTab === "docs" && (
        <div style={{ background: "white", borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
          <h3 style={{ fontSize: 15, fontWeight: 600, color: "#111827", marginBottom: 20 }}>æ›¸é¡</h3>
          <div style={{ padding: 20, background: "#f9fafb", borderRadius: 10, textAlign: "center", color: "#9ca3af", fontSize: 13 }}>
            <Icon name="file-text" size={24} color="#d1d5db" />
            <div style={{ marginTop: 8 }}>æå‡ºæ›¸é¡ã¯ã¾ã ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>
            <button style={{ marginTop: 12, padding: "8px 20px", border: "1px solid #d1d5db", borderRadius: 8, background: "white", fontSize: 12, cursor: "pointer", color: "#374151" }}>æ›¸é¡ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
          </div>
        </div>
      )}
    </div>
  );
}

// Pipeline - é¸è€ƒãƒ•ãƒ­ãƒ¼è©³ç´°ãƒ“ãƒ¥ãƒ¼ï¼ˆåˆè¨ˆä¸€æœ¬åŒ–ï¼‰
// å€™è£œè€…ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰é¸è€ƒãƒ•ãƒ­ãƒ¼ã‚’å‹•çš„ã«æ§‹ç¯‰ã™ã‚‹é–¢æ•°
function buildPipelineFromCandidates(candidates) {
  // original_stage â†’ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¸ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°
  const stageMap = {
    "ã‚¨ãƒ³ãƒˆãƒªãƒ¼/å—ä»˜æ¸ˆ": "entry",
    "èª¬æ˜ä¼š/å‚åŠ æ¸ˆ": "briefing",
    "èª¬æ˜ä¼š/äºˆç´„æ¸ˆ": "briefing",
    "èª¬æ˜ä¼š/æ¬ å¸­": "briefing",
    "1æ¬¡é¢æ¥": "hr-interview",
    "2æ¬¡é¢æ¥": "secondary",
    "æœ€çµ‚é¢æ¥": "exec-interview",
    "å†…å®šæ‰¿è«¾/æ‰¿è«¾æ¸ˆ": "offer",
  };

  // original_stage â†’ ã‚µãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  const substageMap = {
    "ã‚¨ãƒ³ãƒˆãƒªãƒ¼/å—ä»˜æ¸ˆ": "å—ä»˜æ¸ˆ",
    "èª¬æ˜ä¼š/å‚åŠ æ¸ˆ": "å‚åŠ ",
    "èª¬æ˜ä¼š/äºˆç´„æ¸ˆ": "äºˆç´„æ¸ˆ",
    "èª¬æ˜ä¼š/æ¬ å¸­": "æ¬ å¸­",
    "1æ¬¡é¢æ¥": "é¸è€ƒä¸­",
    "2æ¬¡é¢æ¥": "é¸è€ƒä¸­",
    "æœ€çµ‚é¢æ¥": "é¸è€ƒä¸­",
    "å†…å®šæ‰¿è«¾/æ‰¿è«¾æ¸ˆ": "æ‰¿è«¾",
  };

  // é›†è¨ˆ
  const counts = {};
  (candidates || []).forEach(c => {
    const stage = c.stage || "";
    const pipelineId = stageMap[stage] || (stage.includes("ã‚¨ãƒ³ãƒˆãƒªãƒ¼") ? "entry" : stage.includes("èª¬æ˜ä¼š") ? "briefing" : stage.includes("1æ¬¡") ? "hr-interview" : stage.includes("2æ¬¡") ? "secondary" : stage.includes("æœ€çµ‚") ? "exec-interview" : stage.includes("å†…å®š") ? "offer" : "entry");
    const sub = substageMap[stage] || stage.split("/")[1] || "ãã®ä»–";
    if (!counts[pipelineId]) counts[pipelineId] = {};
    if (!counts[pipelineId][sub]) counts[pipelineId][sub] = 0;
    counts[pipelineId][sub]++;
  });

  const totalCandidates = (candidates || []).length;

  const pipeline = [
    { id: "entry", name: "ã‚¨ãƒ³ãƒˆãƒªãƒ¼", color: "#6366f1", icon: "users",
      subs: [{ status: "å—ä»˜æ¸ˆ", color: "#6366f1" }] },
    { id: "briefing", name: "èª¬æ˜ä¼š", color: "#8b5cf6", icon: "volume",
      subs: [{ status: "äºˆç´„æ¸ˆ", color: "#a78bfa" }, { status: "å‚åŠ ", color: "#8b5cf6" }, { status: "æ¬ å¸­", color: "#ef4444", isAlert: true }] },
    { id: "hr-interview", name: "1æ¬¡é¢æ¥", color: "#a855f7", icon: "user",
      subs: [{ status: "é¸è€ƒä¸­", color: "#a855f7" }] },
    { id: "secondary", name: "2æ¬¡é¢æ¥", color: "#d946ef", icon: "check-square",
      subs: [{ status: "é¸è€ƒä¸­", color: "#d946ef" }] },
    { id: "exec-interview", name: "æœ€çµ‚é¢æ¥", color: "#ec4899", icon: "star",
      subs: [{ status: "é¸è€ƒä¸­", color: "#ec4899" }] },
    { id: "offer", name: "å†…å®š", color: "#10b981", icon: "check-circle",
      subs: [{ status: "æ‰¿è«¾", color: "#10b981" }] },
  ];

  return pipeline.map(p => ({
    ...p,
    substages: p.subs.map(s => ({
      ...s,
      staying: (counts[p.id] && counts[p.id][s.status]) || 0,
      total: (counts[p.id] && counts[p.id][s.status]) || 0,
    })).filter(s => s.staying > 0 || !s.isAlert),
  })).map(p => {
    // ã‚µãƒ–ã‚¹ãƒ†ãƒ¼ã‚¸ãŒç©ºãªã‚‰ã€Œ0åã€è¡¨ç¤ºç”¨ã«1ã¤è¿½åŠ 
    if (p.substages.length === 0) {
      p.substages = [{ status: "â€”", staying: 0, total: 0, color: p.color }];
    }
    return p;
  });
}

// ã‚µãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®è¡Œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
function SubstageRow({ sub, maxTotal, onClickStaying }) {
  const barWidth = maxTotal > 0 ? (sub.total / maxTotal) * 100 : 0;
  const isClickable = sub.staying > 0 && onClickStaying;
  return (
    <div style={{ display: "flex", alignItems: "center", gap: 8, padding: "6px 0" }}>
      <div style={{ width: 56, fontSize: 11, color: sub.isAlert ? "#ef4444" : "#6b7280", fontWeight: 500, flexShrink: 0 }}>
        {sub.status}
      </div>
      <div style={{ flex: 1, position: "relative", height: 22, background: "#f9fafb", borderRadius: 6, overflow: "hidden",
        cursor: isClickable ? "pointer" : "default" }}
        onClick={isClickable ? onClickStaying : undefined}>
        <div style={{
          height: "100%", borderRadius: 6,
          background: sub.isAlert
            ? "linear-gradient(90deg, #fecaca, #fca5a5)"
            : `linear-gradient(90deg, ${sub.color}30, ${sub.color}60)`,
          width: `${barWidth}%`, transition: "width 0.5s",
        }} />
        {sub.staying > 0 && (
          <div style={{
            position: "absolute", left: 0, top: 0, height: "100%", borderRadius: 6,
            background: sub.isAlert ? "#ef4444" : sub.color,
            width: `${maxTotal > 0 ? (sub.staying / maxTotal) * 100 : 0}%`,
            opacity: 0.85, transition: "width 0.5s",
          }} />
        )}
      </div>
      <div style={{ width: 32, textAlign: "right", flexShrink: 0 }}>
        <span onClick={isClickable ? onClickStaying : undefined}
          style={{
            fontSize: 13, fontWeight: 700,
            color: sub.staying > 0 ? (sub.isAlert ? "#ef4444" : "#111827") : "#d1d5db",
            cursor: isClickable ? "pointer" : "default",
            borderBottom: isClickable ? "1px dashed currentColor" : "none",
            transition: "opacity 0.15s",
          }}
          onMouseOver={e => { if (isClickable) e.target.style.opacity = "0.7"; }}
          onMouseOut={e => { if (isClickable) e.target.style.opacity = "1"; }}>
          {sub.staying}
        </span>
      </div>
      <div style={{ width: 36, textAlign: "right", flexShrink: 0, fontSize: 10, color: "#9ca3af" }}>
        /{sub.total}
      </div>
    </div>
  );
}

// ã‚¹ãƒ†ãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰ï¼ˆåˆè¨ˆä¸€æœ¬åŒ–ãƒ»ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
function StageCard({ stage, onSubstageClick }) {
  const maxTotal = Math.max(...stage.substages.map(s => s.total), 1);
  const totalStaying = stage.substages.reduce((a, s) => a + (s.isAlert ? 0 : s.staying), 0);
  const alertCount = stage.substages.filter(s => s.isAlert).reduce((a, s) => a + s.staying, 0);

  return (
    <div style={{ background: "white", borderRadius: 14, boxShadow: "0 2px 8px rgba(0,0,0,0.06)", overflow: "hidden", minWidth: 200, flex: 1 }}>
      <div style={{ height: 4, background: `linear-gradient(90deg, ${stage.color}, ${stage.color}99)` }} />
      <div style={{ padding: "14px 16px 4px" }}>
        <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 10 }}>
          <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
            <Icon name={stage.icon} size={15} color={stage.color} />
            <span style={{ fontSize: 13, fontWeight: 700, color: "#111827" }}>{stage.name}</span>
          </div>
          <span style={{ fontSize: 18, fontWeight: 800, color: stage.color }}>{totalStaying}</span>
        </div>
      </div>
      <div style={{ padding: "0 16px 14px" }}>
        {stage.substages.map((sub, i) => (
          <SubstageRow key={i} sub={sub} maxTotal={maxTotal}
            onClickStaying={onSubstageClick ? () => onSubstageClick(stage.name, sub.status) : undefined} />
        ))}
        {alertCount > 0 && (
          <div style={{ marginTop: 6, padding: "4px 8px", background: "#fef2f2", borderRadius: 6, display: "flex", alignItems: "center", gap: 4, fontSize: 10, color: "#ef4444" }}>
            <Icon name="alert-circle" size={11} color="#ef4444" /> æ¬ å¸­/è¾é€€ {alertCount}å
          </div>
        )}
      </div>
    </div>
  );
}

function PipelinePage({ recruitFilter, onNavigateFromPipeline, candidates }) {
  const [viewMode, setViewMode] = useState("detail");
  const DETAILED_PIPELINE = buildPipelineFromCandidates(candidates);
  const totalEntry = (candidates || []).length;
  const totalActive = DETAILED_PIPELINE.reduce((a, s) => a + s.substages.reduce((sa, sub) => sa + sub.staying, 0), 0);

  return (
    <div style={{ padding: 24, maxWidth: 1400 }}>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 20 }}>
        <div>
          <h1 style={{ fontSize: 22, fontWeight: 700, color: "#111827" }}>é¸è€ƒãƒ•ãƒ­ãƒ¼</h1>
          <div style={{ fontSize: 12, color: "#6b7280", marginTop: 4 }}>
            å…¨ã‚¨ãƒ³ãƒˆãƒªãƒ¼ <strong style={{ color: "#6366f1" }}>{totalEntry}å</strong> ãƒ» ç¾åœ¨æ»ç•™ <strong style={{ color: "#111827" }}>{totalActive}å</strong>
          </div>
        </div>
        <div style={{ display: "flex", gap: 4, background: "#f3f4f6", borderRadius: 8, padding: 3 }}>
          <button onClick={() => setViewMode("detail")}
            style={{ display: "flex", alignItems: "center", gap: 4, padding: "6px 14px", border: "none", borderRadius: 6, fontSize: 12, cursor: "pointer",
              background: viewMode === "detail" ? "white" : "transparent",
              color: viewMode === "detail" ? "#4338ca" : "#6b7280",
              fontWeight: viewMode === "detail" ? 600 : 400,
              boxShadow: viewMode === "detail" ? "0 1px 2px rgba(0,0,0,0.08)" : "none" }}>
            <Icon name="git-branch" size={13} /> è©³ç´°ãƒ•ãƒ­ãƒ¼
          </button>
          <button onClick={() => setViewMode("trend")}
            style={{ display: "flex", alignItems: "center", gap: 4, padding: "6px 14px", border: "none", borderRadius: 6, fontSize: 12, cursor: "pointer",
              background: viewMode === "trend" ? "white" : "transparent",
              color: viewMode === "trend" ? "#4338ca" : "#6b7280",
              fontWeight: viewMode === "trend" ? 600 : 400,
              boxShadow: viewMode === "trend" ? "0 1px 2px rgba(0,0,0,0.08)" : "none" }}>
            <Icon name="bar-chart" size={13} /> æœˆæ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰
          </button>
        </div>
      </div>

      {/* å‡¡ä¾‹ */}
      <div style={{ display: "flex", gap: 20, marginBottom: 16, fontSize: 11, color: "#6b7280", alignItems: "center" }}>
        <span style={{ display: "flex", alignItems: "center", gap: 4 }}>
          <div style={{ width: 12, height: 12, borderRadius: 3, background: "#6366f1" }} /> æ»ç•™äººæ•°
        </span>
        <span style={{ display: "flex", alignItems: "center", gap: 4 }}>
          <div style={{ width: 12, height: 12, borderRadius: 3, background: "#6366f130" }} /> ç´¯è¨ˆé€šé
        </span>
        <span style={{ display: "flex", alignItems: "center", gap: 4 }}>
          <div style={{ width: 12, height: 12, borderRadius: 3, background: "#ef4444" }} /> æ¬ å¸­ãƒ»è¾é€€
        </span>
        <span style={{ marginLeft: "auto", fontSize: 11, color: "#9ca3af" }}>
          æ•°å­—: æ»ç•™ / ç´¯è¨ˆ
        </span>
      </div>

      {viewMode === "detail" ? (
        <>
          {/* ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ï¼šæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªã‚¹ãƒ†ãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰ */}
          <div style={{ display: "flex", gap: 10, overflowX: "auto", paddingBottom: 16, alignItems: "flex-start" }}>
            {DETAILED_PIPELINE.map((stage, i) => (
              <div key={stage.id} style={{ display: "flex", alignItems: "flex-start", gap: 10 }}>
                <StageCard stage={stage} onSubstageClick={onNavigateFromPipeline} />
                {i < DETAILED_PIPELINE.length - 1 && (
                  <div style={{ display: "flex", alignItems: "center", paddingTop: 30, flexShrink: 0 }}>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#d1d5db" strokeWidth="2">
                      <path d="M5 12h14M12 5l7 7-7 7" />
                    </svg>
                  </div>
                )}
              </div>
            ))}
          </div>

          {/* ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‹•çš„ç”Ÿæˆï¼‰ */}
          {(() => {
            const alerts = [];
            DETAILED_PIPELINE.forEach(stage => {
              stage.substages.forEach(sub => {
                if (sub.isAlert && sub.staying > 0) {
                  alerts.push({ title: `${stage.name}ã®${sub.status}`, desc: `${sub.status} ${sub.staying}åã€‚ãƒ•ã‚©ãƒ­ãƒ¼é€£çµ¡ã‚’æ¨å¥¨`, severity: sub.staying >= 10 ? "high" : "medium", count: sub.staying });
                }
              });
              // äºˆç´„æ¸ˆã§å¤šæ•°æ»ç•™
              stage.substages.forEach(sub => {
                if (!sub.isAlert && sub.status === "äºˆç´„æ¸ˆ" && sub.staying >= 20) {
                  alerts.push({ title: `${stage.name} â†’ äºˆç´„æ¸ˆã®æ»ç•™`, desc: `äºˆç´„æ¸ˆ ${sub.staying}åãŒæœªå‚åŠ ã€‚ãƒªãƒã‚¤ãƒ³ãƒ‰é€ä¿¡ã‚’æ¨å¥¨`, severity: "high", count: sub.staying });
                }
              });
            });
            if (alerts.length === 0) return null;
            return (
              <div style={{ background: "linear-gradient(135deg, #fef2f2, #fff1f2)", borderRadius: 12, padding: 20, border: "1px solid #fecaca", marginTop: 8 }}>
                <h3 style={{ fontSize: 14, fontWeight: 600, color: "#dc2626", marginBottom: 12, display: "flex", alignItems: "center", gap: 6 }}>
                  <Icon name="alert-circle" size={16} color="#dc2626" /> ãƒœãƒˆãƒ«ãƒãƒƒã‚¯æ¤œçŸ¥
                </h3>
                <div style={{ display: "grid", gridTemplateColumns: alerts.length >= 3 ? "1fr 1fr 1fr" : alerts.length === 2 ? "1fr 1fr" : "1fr", gap: 12 }}>
                  {alerts.map((item, i) => (
                    <div key={i} style={{ padding: 14, background: "white", borderRadius: 10, border: `1px solid ${item.severity === "high" ? "#fecaca" : "#fde68a"}` }}>
                      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 6 }}>
                        <span style={{ fontSize: 12, fontWeight: 600, color: "#111827" }}>{item.title}</span>
                        <span style={{ fontSize: 16, fontWeight: 800, color: item.severity === "high" ? "#ef4444" : "#f59e0b" }}>{item.count}</span>
                      </div>
                      <div style={{ fontSize: 11, color: "#6b7280", lineHeight: 1.5 }}>{item.desc}</div>
                    </div>
                  ))}
                </div>
              </div>
            );
          })()}
        </>
      ) : (
        /* æœˆæ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰ */
        <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
          <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>æœˆæ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰</h3>
          <ResponsiveContainer width="100%" height={300}>
            <LineChart data={MONTHLY_TREND}>
              <XAxis dataKey="month" tick={{ fontSize: 11 }} />
              <YAxis tick={{ fontSize: 11 }} />
              <Tooltip />
              <Legend wrapperStyle={{ fontSize: 11 }} />
              <Line type="monotone" dataKey="entries" name="ã‚¨ãƒ³ãƒˆãƒªãƒ¼" stroke="#6366f1" strokeWidth={2} dot={{ r: 4 }} />
              <Line type="monotone" dataKey="passes" name="é€šé" stroke="#10b981" strokeWidth={2} dot={{ r: 4 }} />
              <Line type="monotone" dataKey="offers" name="å†…å®š" stroke="#f59e0b" strokeWidth={2} dot={{ r: 4 }} />
            </LineChart>
          </ResponsiveContainer>
        </div>
      )}
    </div>
  );
}

// Interview Feedback
function InterviewFBPage({ onNavigate }) {
  const [isRecording, setIsRecording] = useState(false);
  const [scores, setScores] = useState({ communication: 4, logic: 5, motivation: 3, cultureFit: 4, skill: 4 });
  const [recommendation, setRecommendation] = useState("yes");
  const [showAI, setShowAI] = useState(false);
  const scoreLabels = { communication: "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŠ›", logic: "è«–ç†çš„æ€è€ƒåŠ›", motivation: "å¿—æœ›åº¦ãƒ»ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³", cultureFit: "ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒ•ã‚£ãƒƒãƒˆ", skill: "ã‚¹ã‚­ãƒ«ãƒ»ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«" };
  const avgScore = (Object.values(scores).reduce((a, b) => a + b, 0) / Object.values(scores).length).toFixed(1);
  return (
    <div style={{ padding: 24, maxWidth: 800 }}>
      <button onClick={() => onNavigate("candidates")} style={{ display: "flex", alignItems: "center", gap: 4, color: "#6366f1", background: "none", border: "none", cursor: "pointer", fontSize: 13, marginBottom: 16 }}>
        <Icon name="arrow-left" size={16} /> æˆ»ã‚‹
      </button>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 20 }}>
        <h1 style={{ fontSize: 22, fontWeight: 700, color: "#111827" }}>é¢æ¥ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å…¥åŠ›</h1>
        <button style={{ padding: "8px 16px", border: "1px solid #d1d5db", borderRadius: 8, background: "white", fontSize: 12, cursor: "pointer", color: "#374151" }}>ä¸‹æ›¸ãä¿å­˜</button>
      </div>
      <div style={{ background: "#f9fafb", borderRadius: 10, padding: "12px 16px", marginBottom: 20, fontSize: 13, color: "#374151", display: "flex", gap: 24, flexWrap: "wrap" }}>
        <span>å€™è£œè€…: <strong>å±±ç”° èŠ±å­</strong></span>
        <span>ã‚¹ãƒ†ãƒ¼ã‚¸: <strong>äºŒæ¬¡é¢æ¥ï¼ˆå½¹å“¡é¢è«‡ï¼‰</strong></span>
        <span>æ—¥æ™‚: <strong>2026/02/26 14:00-14:45</strong></span>
        <span>é¢æ¥å®˜: <strong>å®‰å²¡</strong></span>
      </div>
      <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)", marginBottom: 16 }}>
        <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16, display: "flex", alignItems: "center", gap: 6 }}>
          <Icon name="mic" size={16} color="#ef4444" /> ãƒœã‚¤ã‚¹ãƒ¬ã‚³ãƒ¼ãƒ€ãƒ¼
        </h3>
        <div style={{ display: "flex", alignItems: "center", gap: 16, padding: "16px", background: isRecording ? "#fef2f2" : "#f9fafb", borderRadius: 10, border: isRecording ? "1px solid #fecaca" : "1px solid #e5e7eb" }}>
          <button onClick={() => { setIsRecording(!isRecording); if (!isRecording) setShowAI(false); }}
            style={{ width: 48, height: 48, borderRadius: "50%", border: "none", background: isRecording ? "#ef4444" : "#6366f1", color: "white", cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center" }}>
            <Icon name={isRecording ? "mic-off" : "mic"} size={22} color="white" />
          </button>
          <div style={{ flex: 1 }}>
            <div style={{ fontSize: 14, fontWeight: 600, color: isRecording ? "#dc2626" : "#374151" }}>
              {isRecording ? "â— éŒ²éŸ³ä¸­..." : "éŒ²éŸ³é–‹å§‹"}
            </div>
            <div style={{ fontSize: 12, color: "#9ca3af", marginTop: 2 }}>
              {isRecording ? "ã‚¯ãƒªãƒƒã‚¯ã—ã¦åœæ­¢" : "éŒ²éŸ³çµ‚äº†å¾Œã€AIãŒè‡ªå‹•ã§æ–‡å­—èµ·ã“ã—ã‚’è¡Œã„ã¾ã™"}
            </div>
          </div>
          <div style={{ fontSize: 20, fontWeight: 600, fontFamily: "monospace", color: isRecording ? "#dc2626" : "#9ca3af" }}>
            {isRecording ? "00:23:45" : "00:00:00"}
          </div>
        </div>
        {!isRecording && (
          <button onClick={() => setShowAI(true)} style={{ marginTop: 12, width: "100%", padding: "10px", border: "1px dashed #c7d2fe", borderRadius: 8, background: "#fafafe", color: "#6366f1", fontSize: 12, cursor: "pointer" }}>
            ğŸ“ æ–‡å­—èµ·ã“ã—çµæœã‚’è¡¨ç¤ºï¼ˆãƒ‡ãƒ¢ï¼‰
          </button>
        )}
      </div>
      <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)", marginBottom: 16 }}>
        <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>è©•ä¾¡</h3>
        {Object.entries(scoreLabels).map(([key, label]) => (
          <div key={key} style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "10px 0", borderBottom: "1px solid #f3f4f6" }}>
            <span style={{ fontSize: 13, color: "#374151", width: 180 }}>{label}</span>
            <div style={{ display: "flex", gap: 8 }}>
              {[1, 2, 3, 4, 5].map(n => (
                <button key={n} onClick={() => setScores(prev => ({ ...prev, [key]: n }))}
                  style={{ width: 36, height: 36, borderRadius: "50%", border: scores[key] === n ? "none" : "2px solid #e5e7eb", background: scores[key] === n ? "#6366f1" : "white", color: scores[key] === n ? "white" : "#6b7280", fontSize: 14, fontWeight: 600, cursor: "pointer" }}>
                  {n}
                </button>
              ))}
            </div>
          </div>
        ))}
        <div style={{ marginTop: 16, padding: "12px 16px", background: "#eef2ff", borderRadius: 8, display: "flex", justifyContent: "space-between", alignItems: "center" }}>
          <span style={{ fontSize: 13, fontWeight: 600, color: "#4338ca" }}>ç·åˆè©•ä¾¡</span>
          <span style={{ fontSize: 22, fontWeight: 700, color: "#4338ca" }}>{avgScore} / 5.0</span>
        </div>
      </div>
      <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)", marginBottom: 16 }}>
        <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 12 }}>æ¨è–¦</h3>
        <div style={{ display: "flex", gap: 8 }}>
          {[["strong_yes", "å¼·ãæ¨è–¦"], ["yes", "æ¨è–¦"], ["neutral", "ä¿ç•™"], ["no", "éæ¨è–¦"], ["strong_no", "å¼·ãéæ¨è–¦"]].map(([val, label]) => (
            <button key={val} onClick={() => setRecommendation(val)}
              style={{ flex: 1, padding: "10px 8px", border: recommendation === val ? "none" : "1px solid #e5e7eb", borderRadius: 8, background: recommendation === val ? (val.includes("yes") ? "#10b981" : val === "neutral" ? "#f59e0b" : "#ef4444") : "white", color: recommendation === val ? "white" : "#6b7280", fontSize: 12, fontWeight: recommendation === val ? 600 : 400, cursor: "pointer" }}>
              {label}
            </button>
          ))}
        </div>
      </div>
      <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)", marginBottom: 16 }}>
        <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 12 }}>ã‚³ãƒ¡ãƒ³ãƒˆ</h3>
        <label style={{ fontSize: 12, fontWeight: 500, color: "#374151", display: "block", marginBottom: 4 }}>å¼·ã¿</label>
        <textarea placeholder="å€™è£œè€…ã®å¼·ã¿ã‚’è¨˜å…¥..." style={{ width: "100%", minHeight: 60, padding: 10, border: "1px solid #d1d5db", borderRadius: 8, fontSize: 13, resize: "vertical", fontFamily: "inherit", boxSizing: "border-box" }} />
        <label style={{ fontSize: 12, fontWeight: 500, color: "#374151", display: "block", marginBottom: 4, marginTop: 12 }}>æ‡¸å¿µç‚¹</label>
        <textarea placeholder="æ‡¸å¿µã•ã‚Œã‚‹ç‚¹ã‚’è¨˜å…¥..." style={{ width: "100%", minHeight: 60, padding: 10, border: "1px solid #d1d5db", borderRadius: 8, fontSize: 13, resize: "vertical", fontFamily: "inherit", boxSizing: "border-box" }} />
      </div>
      {showAI && (
        <div style={{ background: "linear-gradient(135deg, #eef2ff, #f5f3ff)", borderRadius: 12, padding: 20, marginBottom: 16, border: "1px solid #c7d2fe" }}>
          <h4 style={{ fontSize: 14, fontWeight: 600, color: "#4338ca", marginBottom: 10 }}>ğŸ’¡ AIææ¡ˆï¼ˆæ–‡å­—èµ·ã“ã—ã‹ã‚‰æŠ½å‡ºï¼‰</h4>
          <ul style={{ margin: 0, paddingLeft: 18, fontSize: 13, color: "#374151", lineHeight: 2 }}>
            <li>å€™è£œè€…ã¯ã€Œãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€ã«ã¤ã„ã¦3å›è¨€åŠ</li>
            <li>å…·ä½“çš„ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰: å¤§å­¦ã‚¼ãƒŸã§ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒ¼ãƒ€ãƒ¼çµŒé¨“</li>
            <li>è³ªå•ã¸ã®å›ç­”æ™‚é–“: å¹³å‡12ç§’ï¼ˆå³ç­”å‚¾å‘ï¼‰</li>
            <li>ç™ºè©±æ¯”ç‡: å€™è£œè€…55% / é¢æ¥å®˜45%ï¼ˆãƒãƒ©ãƒ³ã‚¹è‰¯å¥½ï¼‰</li>
          </ul>
          <button style={{ marginTop: 10, padding: "8px 16px", border: "none", borderRadius: 8, background: "#4338ca", color: "white", fontSize: 12, cursor: "pointer" }}>ã“ã®å†…å®¹ã‚’ãƒ¡ãƒ¢ã«åæ˜ ã™ã‚‹</button>
        </div>
      )}
      <div style={{ display: "flex", gap: 12, justifyContent: "flex-end" }}>
        <button style={{ padding: "12px 24px", border: "1px solid #d1d5db", borderRadius: 8, background: "white", fontSize: 13, cursor: "pointer", color: "#374151" }}>ä¸‹æ›¸ãä¿å­˜</button>
        <button style={{ padding: "12px 24px", border: "none", borderRadius: 8, background: "#6366f1", color: "white", fontSize: 13, fontWeight: 600, cursor: "pointer", display: "flex", alignItems: "center", gap: 6 }}>
          <Icon name="check-circle" size={16} /> è©•ä¾¡ã‚’ç¢ºå®šã—ã¦é€ä¿¡
        </button>
      </div>
    </div>
  );
}

// Schedule Page - æœ¬æ—¥ã®äºˆç´„ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§
function SchedulePage({ recruitFilter }) {
  const todayEvents = [
    { time: "10:00-10:30", name: "ä½è—¤ å¤ªéƒ", stage: "èª¬æ˜ä¼š", format: "WEB", interviewer: null, type: "æ–°å’", meetUrl: "https://meet.google.com/xxx", location: null },
    { time: "11:00-11:45", name: "å°æ— ç”±ç¾", stage: "ä¸€æ¬¡é¢æ¥", format: "WEB", interviewer: "ä½ã€…æœ¨", type: "ä¸­é€”", meetUrl: "https://meet.google.com/yyy", location: null },
    { time: "14:00-14:45", name: "å±±ç”° èŠ±å­", stage: "äºŒæ¬¡é¢æ¥", format: "å¯¾é¢", interviewer: "å®‰å²¡", type: "æ–°å’", meetUrl: null, location: "æœ¬ç¤¾ 3F ä¼šè­°å®¤A" },
    { time: "15:30-16:15", name: "æ¾æœ¬ å¤§ä»‹", stage: "äºŒæ¬¡é¢æ¥", format: "å¯¾é¢", interviewer: "éˆ´æœ¨", type: "ä¸­é€”", meetUrl: null, location: "æœ¬ç¤¾ 3F ä¼šè­°å®¤B" },
    { time: "16:00-16:45", name: "ç”°ä¸­ å¥ä¸€", stage: "æœ€çµ‚é¢æ¥", format: "å¯¾é¢", interviewer: "ç”°ä¸­éƒ¨é•·", type: "æ–°å’", meetUrl: null, location: "æœ¬ç¤¾ 5F å½¹å“¡å®¤" },
    { time: "17:00-17:30", name: "åŠ è—¤ ç¿”å¤ª", stage: "æ›¸é¡é¸è€ƒçµæœé€šçŸ¥", format: "WEB", interviewer: null, type: "ä¸­é€”", meetUrl: "https://meet.google.com/zzz", location: null },
  ];

  const filtered = recruitFilter === "all" ? todayEvents : todayEvents.filter(e => e.type === recruitFilter);
  const webCount = filtered.filter(e => e.format === "WEB").length;
  const inPersonCount = filtered.filter(e => e.format === "å¯¾é¢").length;

  return (
    <div style={{ padding: 24, maxWidth: 900 }}>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 20 }}>
        <div>
          <h1 style={{ fontSize: 22, fontWeight: 700, color: "#111827" }}>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h1>
          <div style={{ fontSize: 12, color: "#6b7280", marginTop: 4 }}>
            æœ¬æ—¥ã®äºˆå®š <strong>{filtered.length}ä»¶</strong>ï¼ˆğŸ’» WEB {webCount}ä»¶ ãƒ» ğŸ¢ å¯¾é¢ {inPersonCount}ä»¶ï¼‰
          </div>
        </div>
        <div style={{ fontSize: 14, fontWeight: 600, color: "#6366f1" }}>
          <Icon name="calendar" size={16} color="#6366f1" style={{ marginRight: 4 }} /> 2026å¹´2æœˆ26æ—¥ï¼ˆæœ¨ï¼‰
        </div>
      </div>

      <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
        {filtered.map((ev, i) => (
          <div key={i} style={{ background: "white", borderRadius: 12, boxShadow: "0 1px 3px rgba(0,0,0,0.08)", overflow: "hidden", display: "flex", border: "1px solid #f3f4f6" }}>
            {/* å·¦ã®è‰²ãƒãƒ¼ */}
            <div style={{ width: 4, background: ev.format === "WEB" ? "#10b981" : "#ec4899", flexShrink: 0 }} />
            <div style={{ flex: 1, padding: "14px 18px", display: "flex", alignItems: "center", gap: 16 }}>
              {/* æ™‚é–“ */}
              <div style={{ width: 100, flexShrink: 0 }}>
                <div style={{ fontSize: 14, fontWeight: 700, color: "#111827" }}>{ev.time.split("-")[0]}</div>
                <div style={{ fontSize: 10, color: "#9ca3af" }}>ã€œ {ev.time.split("-")[1]}</div>
              </div>
              {/* ãƒãƒƒã‚¸ç¾¤ */}
              <div style={{ display: "flex", gap: 4, flexShrink: 0 }}>
                <FormatBadge format={ev.format} />
                <RecruitTypeBadge type={ev.type} />
              </div>
              {/* ãƒ¡ã‚¤ãƒ³æƒ…å ± */}
              <div style={{ flex: 1 }}>
                <div style={{ fontSize: 14, fontWeight: 600, color: "#111827" }}>{ev.name}</div>
                <div style={{ fontSize: 12, color: "#6b7280", marginTop: 2 }}>
                  {ev.stage}{ev.interviewer ? ` ãƒ» é¢æ¥å®˜: ${ev.interviewer}` : ""}
                </div>
              </div>
              {/* å ´æ‰€/ãƒªãƒ³ã‚¯ */}
              <div style={{ textAlign: "right", flexShrink: 0 }}>
                {ev.format === "WEB" ? (
                  <div style={{ display: "flex", alignItems: "center", gap: 4, fontSize: 11, color: "#10b981", fontWeight: 500 }}>
                    <Icon name="volume" size={12} color="#10b981" /> Google Meet
                  </div>
                ) : (
                  <div style={{ fontSize: 11, color: "#6b7280" }}>
                    <Icon name="building" size={12} color="#9ca3af" style={{ marginRight: 3 }} />
                    {ev.location}
                  </div>
                )}
              </div>
            </div>
          </div>
        ))}
      </div>

      {/* GCalé€£æºã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */}
      <div style={{ marginTop: 24, padding: "16px 20px", background: "#f0fdf4", borderRadius: 12, border: "1px solid #bbf7d0", display: "flex", alignItems: "center", gap: 12 }}>
        <Icon name="check-circle" size={18} color="#16a34a" />
        <div style={{ flex: 1 }}>
          <div style={{ fontSize: 13, fontWeight: 600, color: "#15803d" }}>Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºä¸­</div>
          <div style={{ fontSize: 11, color: "#16a34a", marginTop: 2 }}>
            ã‚¿ã‚¤ãƒˆãƒ«ã«ã€ŒWEBã€ã€Œå¯¾é¢ã€ãŒè‡ªå‹•åæ˜ ã•ã‚Œã¾ã™ã€‚ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒ¼ãƒ«ã‚‚å½¢æ…‹ã«å¿œã˜ã¦è‡ªå‹•é€ä¿¡ã•ã‚Œã¾ã™ã€‚
          </div>
        </div>
        <button style={{ padding: "6px 14px", border: "1px solid #86efac", borderRadius: 8, background: "white", fontSize: 12, cursor: "pointer", color: "#15803d" }}>è¨­å®š</button>
      </div>
    </div>
  );
}

// Automation
function AutomationPage() {
  const [triggers, setTriggers] = useState(AUTOMATION_TRIGGERS);
  return (
    <div style={{ padding: 24, maxWidth: 1000 }}>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 20 }}>
        <h1 style={{ fontSize: 22, fontWeight: 700, color: "#111827" }}>è‡ªå‹•åŒ–è¨­å®š</h1>
        <button style={{ display: "flex", alignItems: "center", gap: 6, background: "#6366f1", color: "white", border: "none", borderRadius: 8, padding: "8px 16px", fontSize: 13, fontWeight: 500, cursor: "pointer" }}>
          <Icon name="plus" size={16} /> æ–°è¦ãƒˆãƒªã‚¬ãƒ¼
        </button>
      </div>
      <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
        {triggers.map(t => (
          <div key={t.id} style={{ background: "white", borderRadius: 12, padding: "16px 20px", boxShadow: "0 1px 3px rgba(0,0,0,0.08)", border: "1px solid #f3f4f6" }}>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start" }}>
              <div style={{ flex: 1 }}>
                <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 6 }}>
                  <Icon name="mail" size={16} color="#6366f1" />
                  <span style={{ fontSize: 14, fontWeight: 600, color: "#111827" }}>{t.name}</span>
                </div>
                <div style={{ fontSize: 12, color: "#6b7280", marginBottom: 6 }}>ãƒˆãƒªã‚¬ãƒ¼: {t.trigger}</div>
                <div style={{ display: "flex", gap: 12, fontSize: 12, color: "#9ca3af" }}>
                  <span>é€ä¿¡å…ˆ: {t.target}</span>
                  <span>é…å»¶: {t.delay}</span>
                </div>
                <div style={{ display: "flex", gap: 6, marginTop: 8 }}>
                  {t.channels.map(ch => (
                    <span key={ch} style={{ fontSize: 10, padding: "2px 8px", borderRadius: 10, background: ch === "LINE" ? "#dcfce7" : "#dbeafe", color: ch === "LINE" ? "#15803d" : "#1d4ed8" }}>{ch}</span>
                  ))}
                </div>
              </div>
              <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                <span style={{ fontSize: 11, color: t.active ? "#10b981" : "#9ca3af" }}>{t.active ? "æœ‰åŠ¹" : "ç„¡åŠ¹"}</span>
                <button onClick={() => setTriggers(prev => prev.map(tr => tr.id === t.id ? { ...tr, active: !tr.active } : tr))}
                  style={{ width: 40, height: 22, borderRadius: 11, border: "none", background: t.active ? "#10b981" : "#d1d5db", cursor: "pointer", position: "relative" }}>
                  <div style={{ width: 18, height: 18, borderRadius: "50%", background: "white", position: "absolute", top: 2, left: t.active ? 20 : 2, transition: "left 0.2s" }} />
                </button>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

// Analytics
function AnalyticsPage({ recruitFilter }) {
  const [tab, setTab] = useState("bias");
  return (
    <div style={{ padding: 24, maxWidth: 1200 }}>
      <h1 style={{ fontSize: 22, fontWeight: 700, color: "#111827", marginBottom: 20 }}>åˆ†æ</h1>
      <div style={{ display: "flex", gap: 4, marginBottom: 20, background: "#f3f4f6", borderRadius: 10, padding: 4, width: "fit-content" }}>
        {[["bias", "é¸è€ƒå®˜ãƒã‚¤ã‚¢ã‚¹"], ["divergence", "ãƒ¡ãƒ¢vséŒ²éŸ³ ä¹–é›¢"], ["traits", "é€šéè€…ã®ç‰¹å¾´"], ["overview", "ç·åˆåˆ†æ"]].map(([id, label]) => (
          <button key={id} onClick={() => setTab(id)}
            style={{ padding: "8px 16px", border: "none", borderRadius: 8, fontSize: 12, cursor: "pointer", background: tab === id ? "white" : "transparent", color: tab === id ? "#4338ca" : "#6b7280", fontWeight: tab === id ? 600 : 400, boxShadow: tab === id ? "0 1px 2px rgba(0,0,0,0.1)" : "none" }}>{label}</button>
        ))}
      </div>
      {tab === "bias" && (
        <>
          <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)", marginBottom: 16 }}>
            <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>é¸è€ƒå®˜ã”ã¨ã®è©•ä¾¡å‚¾å‘</h3>
            <table style={{ width: "100%", borderCollapse: "collapse" }}>
              <thead>
                <tr style={{ background: "#f9fafb" }}>
                  {["é¸è€ƒå®˜", "å¹³å‡ç‚¹", "é€šéç‡", "ç”˜/è¾›", "åå·®", "è©•ä¾¡ä»¶æ•°"].map((h, i) => (
                    <th key={i} style={{ padding: "10px 16px", fontSize: 11, fontWeight: 600, color: "#6b7280", textAlign: "left", borderBottom: "1px solid #e5e7eb" }}>{h}</th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {EVALUATOR_BIAS.map((e, i) => (
                  <tr key={i} style={{ borderBottom: "1px solid #f3f4f6" }}>
                    <td style={{ padding: "12px 16px", fontSize: 13, fontWeight: 600, color: "#111827" }}>{e.name}</td>
                    <td style={{ padding: "12px 16px", fontSize: 14, fontWeight: 700, color: e.avg >= 4 ? "#10b981" : e.avg >= 3.5 ? "#f59e0b" : "#ef4444" }}>{e.avg}</td>
                    <td style={{ padding: "12px 16px", fontSize: 13, color: "#374151" }}>{e.passRate}%</td>
                    <td style={{ padding: "12px 16px" }}>
                      <span style={{ fontSize: 11, padding: "2px 10px", borderRadius: 10, background: e.tendency === "ç”˜ã‚" ? "#dcfce7" : e.tendency === "è¾›ã‚" ? "#fee2e2" : "#f3f4f6", color: e.tendency === "ç”˜ã‚" ? "#15803d" : e.tendency === "è¾›ã‚" ? "#dc2626" : "#6b7280" }}>{e.tendency}</span>
                    </td>
                    <td style={{ padding: "12px 16px", fontSize: 13, color: "#374151" }}>{e.variance}</td>
                    <td style={{ padding: "12px 16px", fontSize: 13, color: "#374151" }}>{e.count}ä»¶</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
            <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
              <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆï¼ˆé¸è€ƒå®˜æ¯”è¼ƒï¼‰</h3>
              <ResponsiveContainer width="100%" height={250}>
                <RadarChart data={RADAR_DATA}>
                  <PolarGrid />
                  <PolarAngleAxis dataKey="subject" tick={{ fontSize: 11 }} />
                  <PolarRadiusAxis domain={[0, 5]} tick={{ fontSize: 9 }} />
                  <Radar name="å®‰å²¡" dataKey="a" stroke="#6366f1" fill="#6366f1" fillOpacity={0.15} />
                  <Radar name="éˆ´æœ¨" dataKey="b" stroke="#10b981" fill="#10b981" fillOpacity={0.15} />
                  <Radar name="ç”°ä¸­éƒ¨é•·" dataKey="c" stroke="#ef4444" fill="#ef4444" fillOpacity={0.15} />
                  <Legend wrapperStyle={{ fontSize: 11 }} />
                </RadarChart>
              </ResponsiveContainer>
            </div>
            <div style={{ background: "linear-gradient(135deg, #eef2ff, #f5f3ff)", borderRadius: 12, padding: 20, border: "1px solid #c7d2fe" }}>
              <h4 style={{ fontSize: 14, fontWeight: 600, color: "#4338ca", marginBottom: 12 }}>ğŸ¤– AIã‚¤ãƒ³ã‚µã‚¤ãƒˆ</h4>
              <div style={{ fontSize: 13, color: "#374151", lineHeight: 1.8 }}>
                <p style={{ marginBottom: 12 }}><strong>1.</strong> ç”°ä¸­éƒ¨é•·ã¯ã€Œè«–ç†çš„æ€è€ƒåŠ›ã€ã‚’é‡è¦–ã™ã‚‹å‚¾å‘ãŒå¼·ãã€ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŠ›ã®è©•ä¾¡ãŒä»–ã®é¢æ¥å®˜ã¨æ¯”ã¹ä½ã‚ã§ã™ã€‚</p>
                <p style={{ marginBottom: 12 }}><strong>2.</strong> éˆ´æœ¨ã•ã‚“ã¯å…¨ä½“çš„ã«é«˜è©•ä¾¡ã‚’ã¤ã‘ã‚‹å‚¾å‘ãŒã‚ã‚Šã¾ã™ï¼ˆå¹³å‡+0.4ï¼‰ã€‚</p>
                <p><strong>3.</strong> é¢æ¥å®˜é–“ã®è©•ä¾¡ä¸€è‡´ç‡: <strong style={{ color: "#f59e0b" }}>68%</strong>ï¼ˆç›®æ¨™: 80%ä»¥ä¸Šï¼‰</p>
              </div>
            </div>
          </div>
        </>
      )}
      {tab === "traits" && (
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
          <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
            <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>é€šéè€…ã®å…±é€šç‰¹å¾´</h3>
            {[
              { trait: "è«–ç†çš„ãªå›ç­”æ§‹æˆï¼ˆPREPæ³•ï¼‰", pct: 85 },
              { trait: "å…·ä½“çš„ãªæ•°å€¤ã‚’ç”¨ã„ãŸã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰", pct: 78 },
              { trait: "ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯çµŒé¨“ã®è¨€åŠ", pct: 72 },
              { trait: "è‡ªç™ºçš„ãªè³ªå•ï¼ˆé€†è³ªå•ï¼‰", pct: 68 },
              { trait: "æ¥­ç•Œç†è§£ã®æ·±ã•", pct: 62 },
            ].map((item, i) => (
              <div key={i} style={{ marginBottom: 12 }}>
                <div style={{ display: "flex", justifyContent: "space-between", fontSize: 12, marginBottom: 4 }}>
                  <span style={{ color: "#374151" }}>{item.trait}</span>
                  <span style={{ fontWeight: 600, color: "#6366f1" }}>{item.pct}%</span>
                </div>
                <div style={{ height: 6, background: "#f3f4f6", borderRadius: 3 }}>
                  <div style={{ height: "100%", background: "#6366f1", borderRadius: 3, width: `${item.pct}%` }} />
                </div>
              </div>
            ))}
          </div>
          <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
            <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>
              {recruitFilter === "ä¸­é€”" ? "å‰è·æ¥­ç•Œåˆ¥é€šéç‡" : "å¤§å­¦åˆ¥é€šéç‡"}
            </h3>
            <ResponsiveContainer width="100%" height={220}>
              <BarChart data={recruitFilter === "ä¸­é€”" ? [
                { name: "ã‚³ãƒ³ã‚µãƒ«", rate: 52 }, { name: "IT", rate: 45 }, { name: "ãƒ¡ãƒ¼ã‚«ãƒ¼", rate: 38 },
                { name: "é‡‘è", rate: 35 }, { name: "å•†ç¤¾", rate: 42 }, { name: "ãã®ä»–", rate: 28 },
              ] : [
                { name: "æ±äº¬å¤§å­¦", rate: 45 }, { name: "æ…¶æ‡‰å¤§å­¦", rate: 38 }, { name: "æ—©ç¨²ç”°å¤§å­¦", rate: 35 },
                { name: "äº¬éƒ½å¤§å­¦", rate: 42 }, { name: "ä¸€æ©‹å¤§å­¦", rate: 30 }, { name: "ãã®ä»–", rate: 25 },
              ]} margin={{ left: 10 }}>
                <XAxis dataKey="name" tick={{ fontSize: 10 }} />
                <YAxis tick={{ fontSize: 10 }} unit="%" />
                <Tooltip />
                <Bar dataKey="rate" name="é€šéç‡" fill="#8b5cf6" radius={[4, 4, 0, 0]} />
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>
      )}
      {tab === "divergence" && (
        <div style={{ background: "white", borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
          <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 20 }}>ãƒ¡ãƒ¢ vs éŒ²éŸ³æ–‡å­—èµ·ã“ã— ä¹–é›¢åˆ†æ</h3>
          {[
            { memo: "ã‚³ãƒŸãƒ¥åŠ›ãŒé«˜ã„", analysis: "å€™è£œè€…ã®ç™ºè©±æ¯”ç‡35%ï¼ˆé¢æ¥å®˜65%ï¼‰", severity: "high", insight: "é¢æ¥å®˜ãŒå¤šãè©±ã—ã¦ãŠã‚Šã€å€™è£œè€…ã®ã‚³ãƒŸãƒ¥åŠ›ã‚’æ­£ç¢ºã«æ¸¬ã‚Œã¦ã„ãªã„å¯èƒ½æ€§" },
            { memo: "å¿—æœ›åº¦ãŒä½ã„", analysis: "ã€Œå¾¡ç¤¾ã€ã€Œãœã²ã€ãªã©ç©æ¥µçš„ãƒ¯ãƒ¼ãƒ‰12å›ä½¿ç”¨", severity: "high", insight: "è¨€èªãƒ‡ãƒ¼ã‚¿ã¨ä¸»è¦³è©•ä¾¡ã«ã‚®ãƒ£ãƒƒãƒ—" },
            { memo: "è«–ç†çš„æ€è€ƒåŠ›ãŒé«˜ã„", analysis: "PREPæ³•ã§ã®å›ç­”ç‡80%ã€æ§‹é€ åŒ–ã‚¹ã‚³ã‚¢4.2/5.0", severity: "low", insight: "ãƒ¡ãƒ¢ã¨å®¢è¦³åˆ†æãŒæ¦‚ã­ä¸€è‡´" },
          ].map((item, i) => (
            <div key={i} style={{ padding: 16, background: i < 2 ? "#fef2f2" : "#f0fdf4", borderRadius: 10, marginBottom: 12, border: `1px solid ${i < 2 ? "#fecaca" : "#bbf7d0"}` }}>
              <div style={{ display: "flex", gap: 12, marginBottom: 8 }}>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: 11, fontWeight: 600, color: "#6b7280", marginBottom: 4 }}>ğŸ“‹ é¢æ¥å®˜ãƒ¡ãƒ¢</div>
                  <div style={{ fontSize: 13, color: "#111827" }}>ã€Œ{item.memo}ã€</div>
                </div>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: 11, fontWeight: 600, color: "#6b7280", marginBottom: 4 }}>ğŸ™ï¸ æ–‡å­—èµ·ã“ã—åˆ†æ</div>
                  <div style={{ fontSize: 13, color: "#111827" }}>{item.analysis}</div>
                </div>
              </div>
              <div style={{ fontSize: 12, color: i < 2 ? "#dc2626" : "#15803d", display: "flex", alignItems: "center", gap: 4 }}>
                <Icon name={i < 2 ? "alert-circle" : "check-circle"} size={14} />
                {i < 2 ? "âš ï¸ ä¹–é›¢ã‚ã‚Š" : "âœ… ä¸€è‡´"}: {item.insight}
              </div>
            </div>
          ))}
        </div>
      )}
      {tab === "overview" && (
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
          <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
            <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>é¸è€ƒé€šéç‡ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥ï¼‰</h3>
            <ResponsiveContainer width="100%" height={220}>
              <BarChart data={[
                { stage: "æ›¸é¡â†’ä¸€æ¬¡", rate: 62 }, { stage: "ä¸€æ¬¡â†’äºŒæ¬¡", rate: 44 },
                { stage: "äºŒæ¬¡â†’æœ€çµ‚", rate: 46 }, { stage: "æœ€çµ‚â†’å†…å®š", rate: 14 },
                { stage: "å†…å®šâ†’æ‰¿è«¾", rate: 42 },
              ]}>
                <XAxis dataKey="stage" tick={{ fontSize: 10 }} />
                <YAxis tick={{ fontSize: 10 }} unit="%" />
                <Tooltip />
                <Bar dataKey="rate" name="é€šéç‡" radius={[4, 4, 0, 0]}>
                  {[0, 1, 2, 3, 4].map(i => <Cell key={i} fill={COLORS[i]} />)}
                </Bar>
              </BarChart>
            </ResponsiveContainer>
          </div>
          <div style={{ background: "white", borderRadius: 12, padding: 20, boxShadow: "0 1px 3px rgba(0,0,0,0.08)" }}>
            <h3 style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>ã‚¨ãƒ³ãƒˆãƒªãƒ¼çµŒè·¯åˆ¥åˆ†å¸ƒ</h3>
            <ResponsiveContainer width="100%" height={220}>
              <PieChart>
                <Pie data={recruitFilter === "ä¸­é€”" ? [
                  { name: "ãƒ“ã‚ºãƒªãƒ¼ãƒ", value: 120 }, { name: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ", value: 95 },
                  { name: "Green", value: 60 }, { name: "ãƒªãƒ•ã‚¡ãƒ©ãƒ«", value: 40 }, { name: "ãã®ä»–", value: 15 },
                ] : [
                  { name: "ãƒªã‚¯ãƒŠãƒ“", value: 320 }, { name: "ãƒã‚¤ãƒŠãƒ“", value: 210 },
                  { name: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ", value: 130 }, { name: "è‡ªç¤¾ã‚µã‚¤ãƒˆ", value: 60 }, { name: "ãã®ä»–", value: 31 },
                ]} cx="50%" cy="50%" outerRadius={80} label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`} labelLine fontSize={10}>
                  {[0, 1, 2, 3, 4].map(i => <Cell key={i} fill={COLORS[i]} />)}
                </Pie>
                <Tooltip />
              </PieChart>
            </ResponsiveContainer>
          </div>
        </div>
      )}
    </div>
  );
}

// ============================================================
// APP
// ============================================================
function App() {
  const [user, setUser] = useState(null);
  const [authChecked, setAuthChecked] = useState(false);
  const [currentPage, setCurrentPage] = useState("dashboard");
  const [selectedCandidateId, setSelectedCandidateId] = useState(null);
  const [recruitFilter, setRecruitFilter] = useState("all");
  const [pipelineFilter, setPipelineFilter] = useState(null);
  const [showAddModal, setShowAddModal] = useState(false);

  // ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒƒã‚¯
  const { candidates, loading: dataLoading, addCandidate, updateCandidate, bulkUpdateStatus, refresh } = useSupabaseCandidates(recruitFilter);

  // èªè¨¼çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
  useEffect(() => {
    if (SUPABASE_READY) {
      sbApi.getUser().then(u => {
        setUser(u || null);
        setAuthChecked(true);
      });
    } else {
      setAuthChecked(true);
    }
  }, []);

  const handleLogout = async () => {
    if (SUPABASE_READY) await sbApi.signOut();
    setUser(null);
  };

  // æœªãƒ­ã‚°ã‚¤ãƒ³ â†’ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
  if (authChecked && !user) {
    return <LoginPage onLogin={(u) => setUser(u)} />;
  }
  if (!authChecked) {
    return <div style={{ minHeight: "100vh", display: "flex", alignItems: "center", justifyContent: "center", background: "#f5f5f7" }}><div style={{ fontSize: 14, color: "#6b7280" }}>èª­ã¿è¾¼ã¿ä¸­...</div></div>;
  }

  const navigate = (page, id) => {
    setCurrentPage(page);
    if (id) setSelectedCandidateId(id);
    if (page !== "candidates" || !id) setPipelineFilter(null);
  };

  const navigateFromPipeline = (stageName, substatus) => {
    setPipelineFilter({ stageName, substatus });
    setCurrentPage("candidates");
  };

  const renderPage = () => {
    switch (currentPage) {
      case "dashboard": return <DashboardPage onNavigate={navigate} recruitFilter={recruitFilter} />;
      case "candidates": return <CandidatesPage onNavigate={navigate} recruitFilter={recruitFilter} pipelineFilter={pipelineFilter} onClearPipelineFilter={() => setPipelineFilter(null)} candidates={candidates} onUpdateCandidate={updateCandidate} onBulkUpdateStatus={bulkUpdateStatus} onShowAddModal={() => setShowAddModal(true)} />;
      case "candidate-detail": return <CandidateDetailPage candidateId={selectedCandidateId} onNavigate={navigate} candidates={candidates} onUpdateCandidate={updateCandidate} />;
      case "pipeline": return <PipelinePage recruitFilter={recruitFilter} onNavigateFromPipeline={navigateFromPipeline} candidates={candidates} />;
      case "schedule": return <SchedulePage recruitFilter={recruitFilter} />;
      case "interview-fb": return <InterviewFBPage onNavigate={navigate} />;
      case "automation": return <AutomationPage />;
      case "analytics": return <AnalyticsPage recruitFilter={recruitFilter} />;
      default: return (
        <div style={{ padding: 24, display: "flex", alignItems: "center", justifyContent: "center", height: "60vh" }}>
          <div style={{ textAlign: "center" }}>
            <div style={{ fontSize: 48, marginBottom: 12 }}>ğŸš§</div>
            <h2 style={{ fontSize: 18, fontWeight: 600, color: "#374151", marginBottom: 4 }}>ã“ã®ç”»é¢ã¯é–‹ç™ºä¸­ã§ã™</h2>
            <p style={{ fontSize: 13, color: "#9ca3af" }}>æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…äºˆå®šã§ã™</p>
          </div>
        </div>
      );
    }
  };

  return (
    <div style={{ display: "flex", minHeight: "100vh", background: "#f5f5f7", fontFamily: "-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Kaku Gothic ProN', sans-serif" }}>
      <Sidebar currentPage={currentPage} onNavigate={navigate} />
      <div style={{ flex: 1, overflowY: "auto", maxHeight: "100vh" }}>
        <div style={{ background: "white", borderBottom: "1px solid #e5e7eb", padding: "10px 24px", display: "flex", justifyContent: "space-between", alignItems: "center", position: "sticky", top: 0, zIndex: 10 }}>
          <div style={{ display: "flex", alignItems: "center", gap: 16 }}>
            <RecruitTypeSelector value={recruitFilter} onChange={setRecruitFilter} />
            {SUPABASE_READY && (
              <span style={{ fontSize: 10, padding: "2px 8px", borderRadius: 6, background: "#dcfce7", color: "#15803d", fontWeight: 600 }}>DBæ¥ç¶šä¸­</span>
            )}
            {!SUPABASE_READY && (
              <span style={{ fontSize: 10, padding: "2px 8px", borderRadius: 6, background: "#fef3c7", color: "#92400e", fontWeight: 600 }}>ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰</span>
            )}
            <div style={{ position: "relative", width: 260 }}>
              <Icon name="search" size={14} color="#9ca3af" style={{ position: "absolute", left: 8, top: 8 }} />
              <input placeholder="å€™è£œè€…ãƒ»ã‚¿ã‚¹ã‚¯ã‚’æ¤œç´¢..." style={{ width: "100%", padding: "6px 6px 6px 28px", border: "1px solid #e5e7eb", borderRadius: 8, fontSize: 12, outline: "none", boxSizing: "border-box" }} />
            </div>
          </div>
          <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
            <button style={{ position: "relative", background: "none", border: "none", cursor: "pointer", padding: 4 }}>
              <Icon name="bell" size={18} color="#6b7280" />
              <div style={{ position: "absolute", top: 0, right: 0, width: 8, height: 8, borderRadius: "50%", background: "#ef4444" }} />
            </button>
            <button onClick={handleLogout} style={{ fontSize: 11, color: "#6b7280", background: "none", border: "1px solid #e5e7eb", borderRadius: 6, padding: "4px 10px", cursor: "pointer" }}>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
          </div>
        </div>
        {renderPage()}
      </div>

      {/* å€™è£œè€…è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« */}
      {showAddModal && <AddCandidateModal onClose={() => setShowAddModal(false)} onAdd={async (c) => { await addCandidate(c); setShowAddModal(false); }} />}
    </div>
  );
}

// ============================================================
// å€™è£œè€…è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«
// ============================================================
function AddCandidateModal({ onClose, onAdd }) {
  const [form, setForm] = useState({
    recruitType: "æ–°å’", lastName: "", firstName: "", lastNameKana: "", firstNameKana: "",
    email: "", phone: "", birthDate: "",
    university: "", faculty: "", department: "", gradYear: 2027, majorType: "æ–‡ç³»", graduationPeriod: "2027å¹´3æœˆ",
    company: "", position: "", experience: "",
    route: "", aspiration: 3, agent: "", gender: "ç”·æ€§", notes: "",
  });
  const [saving, setSaving] = useState(false);
  const set = (key, val) => setForm(prev => ({ ...prev, [key]: val }));
  const isNew = form.recruitType === "æ–°å’";

  const handleSave = async () => {
    if (!form.lastName || !form.firstName) return;
    setSaving(true);
    await onAdd({
      ...form,
      stage: "ã‚¨ãƒ³ãƒˆãƒªãƒ¼/å—ä»˜æ¸ˆ",
      substatus: "å—ä»˜æ¸ˆ",
      status: "æ–°è¦",
      format: null,
      score: null,
      experience: form.experience ? parseInt(form.experience) : null,
      entryDate: new Date().toISOString().split("T")[0],
    });
    setSaving(false);
  };

  const inputStyle = { width: "100%", padding: "8px 12px", border: "1px solid #d1d5db", borderRadius: 8, fontSize: 13, outline: "none", boxSizing: "border-box" };
  const labelStyle = { display: "block", fontSize: 11, fontWeight: 600, color: "#374151", marginBottom: 4 };

  return (
    <div style={{ position: "fixed", inset: 0, background: "rgba(0,0,0,0.4)", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1000 }} onClick={onClose}>
      <div style={{ background: "white", borderRadius: 16, padding: 28, width: 520, maxHeight: "80vh", overflowY: "auto", boxShadow: "0 20px 60px rgba(0,0,0,0.2)" }} onClick={e => e.stopPropagation()}>
        <h2 style={{ fontSize: 18, fontWeight: 700, marginBottom: 20, color: "#111827" }}>å€™è£œè€…ã‚’æ–°è¦ç™»éŒ²</h2>

        {/* æ¡ç”¨åŒºåˆ† */}
        <div style={{ display: "flex", gap: 8, marginBottom: 16 }}>
          {["æ–°å’", "ä¸­é€”"].map(t => (
            <button key={t} onClick={() => set("recruitType", t)}
              style={{ flex: 1, padding: "8px", border: form.recruitType === t ? "2px solid #4338ca" : "1px solid #d1d5db", borderRadius: 8, background: form.recruitType === t ? "#eef2ff" : "white", fontSize: 13, fontWeight: 600, cursor: "pointer", color: form.recruitType === t ? "#4338ca" : "#6b7280" }}>
              {t}
            </button>
          ))}
        </div>

        {/* åŸºæœ¬æƒ…å ± */}
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 16 }}>
          <div><label style={labelStyle}>å§“ *</label><input value={form.lastName} onChange={e => set("lastName", e.target.value)} style={inputStyle} placeholder="å±±ç”°" /></div>
          <div><label style={labelStyle}>å *</label><input value={form.firstName} onChange={e => set("firstName", e.target.value)} style={inputStyle} placeholder="èŠ±å­" /></div>
          <div><label style={labelStyle}>ã‚»ã‚¤</label><input value={form.lastNameKana} onChange={e => set("lastNameKana", e.target.value)} style={inputStyle} placeholder="ãƒ¤ãƒãƒ€" /></div>
          <div><label style={labelStyle}>ãƒ¡ã‚¤</label><input value={form.firstNameKana} onChange={e => set("firstNameKana", e.target.value)} style={inputStyle} placeholder="ãƒãƒŠã‚³" /></div>
          <div><label style={labelStyle}>ãƒ¡ãƒ¼ãƒ«</label><input type="email" value={form.email} onChange={e => set("email", e.target.value)} style={inputStyle} placeholder="email@example.com" /></div>
          <div><label style={labelStyle}>é›»è©±</label><input value={form.phone} onChange={e => set("phone", e.target.value)} style={inputStyle} placeholder="090-1234-5678" /></div>
          <div><label style={labelStyle}>ç”Ÿå¹´æœˆæ—¥</label><input type="date" value={form.birthDate} onChange={e => set("birthDate", e.target.value)} style={inputStyle} /></div>
          <div><label style={labelStyle}>æ€§åˆ¥</label>
            <select value={form.gender} onChange={e => set("gender", e.target.value)} style={inputStyle}>
              <option value="ç”·æ€§">ç”·æ€§</option><option value="å¥³æ€§">å¥³æ€§</option><option value="ãã®ä»–">ãã®ä»–</option>
            </select>
          </div>
        </div>

        {/* æ–°å’ or ä¸­é€”å›ºæœ‰ */}
        {isNew ? (
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 16 }}>
            <div><label style={labelStyle}>å¤§å­¦</label><input value={form.university} onChange={e => set("university", e.target.value)} style={inputStyle} placeholder="â—‹â—‹å¤§å­¦" /></div>
            <div><label style={labelStyle}>å­¦éƒ¨</label><input value={form.faculty} onChange={e => set("faculty", e.target.value)} style={inputStyle} placeholder="â—‹â—‹å­¦éƒ¨" /></div>
            <div><label style={labelStyle}>å­¦ç§‘</label><input value={form.department} onChange={e => set("department", e.target.value)} style={inputStyle} placeholder="â—‹â—‹å­¦ç§‘" /></div>
            <div><label style={labelStyle}>æ–‡ç†</label>
              <select value={form.majorType} onChange={e => set("majorType", e.target.value)} style={inputStyle}>
                <option value="æ–‡ç³»">æ–‡ç³»</option><option value="ç†ç³»">ç†ç³»</option>
              </select>
            </div>
            <div><label style={labelStyle}>å’æ¥­å¹´</label><input type="number" value={form.gradYear} onChange={e => set("gradYear", parseInt(e.target.value))} style={inputStyle} /></div>
            <div><label style={labelStyle}>å’æ¥­äºˆå®šæ™‚æœŸ</label><input value={form.graduationPeriod} onChange={e => set("graduationPeriod", e.target.value)} style={inputStyle} placeholder="2027å¹´3æœˆ" /></div>
          </div>
        ) : (
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 16 }}>
            <div><label style={labelStyle}>ç¾è·ä¼æ¥­</label><input value={form.company} onChange={e => set("company", e.target.value)} style={inputStyle} /></div>
            <div><label style={labelStyle}>è·ç¨®</label><input value={form.position} onChange={e => set("position", e.target.value)} style={inputStyle} /></div>
            <div><label style={labelStyle}>çµŒé¨“å¹´æ•°</label><input type="number" value={form.experience} onChange={e => set("experience", e.target.value)} style={inputStyle} /></div>
            <div />
          </div>
        )}

        {/* ãƒ¡ã‚¿æƒ…å ± */}
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 16 }}>
          <div><label style={labelStyle}>å¿œå‹ŸçµŒè·¯</label><input value={form.route} onChange={e => set("route", e.target.value)} style={inputStyle} placeholder="ãƒã‚¤ãƒŠãƒ“ã€ç´¹ä»‹ä¼šç¤¾ ç­‰" /></div>
          <div><label style={labelStyle}>ç´¹ä»‹ä¼šç¤¾/ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</label><input value={form.agent} onChange={e => set("agent", e.target.value)} style={inputStyle} /></div>
          <div><label style={labelStyle}>å¿—æœ›åº¦</label>
            <select value={form.aspiration} onChange={e => set("aspiration", parseInt(e.target.value))} style={inputStyle}>
              {[1,2,3,4,5].map(n => <option key={n} value={n}>{n} - {"â˜…".repeat(n)}</option>)}
            </select>
          </div>
        </div>
        <div style={{ marginBottom: 24 }}>
          <label style={labelStyle}>ãƒ¡ãƒ¢</label>
          <textarea value={form.notes} onChange={e => set("notes", e.target.value)} style={{ ...inputStyle, minHeight: 60, resize: "vertical" }} placeholder="è‡ªç”±è¨˜å…¥æ¬„" />
        </div>

        <div style={{ display: "flex", gap: 10, justifyContent: "flex-end" }}>
          <button onClick={onClose} style={{ padding: "8px 20px", border: "1px solid #d1d5db", borderRadius: 8, background: "white", fontSize: 13, cursor: "pointer", color: "#374151" }}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button onClick={handleSave} disabled={saving || !form.lastName || !form.firstName}
            style={{ padding: "8px 24px", border: "none", borderRadius: 8, background: (!form.lastName || !form.firstName) ? "#a5b4fc" : "#4338ca", color: "white", fontSize: 13, fontWeight: 600, cursor: saving ? "default" : "pointer" }}>
            {saving ? "ä¿å­˜ä¸­..." : "ç™»éŒ²ã™ã‚‹"}
          </button>
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
